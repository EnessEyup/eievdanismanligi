<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- SEO Meta Tags -->
    <title>Eksik Kira Hesaplayıcısı 2025 - Ücretsiz Kira Hesaplama Aracı | Eyüpoğlu & Işıkgör</title>
    <meta name="title" content="Eksik Kira Hesaplayıcısı 2025 - Ücretsiz Kira Hesaplama Aracı | Eyüpoğlu & Işıkgör">
    <meta name="description" content="Kiracınızdan ne kadar eksik kira alabilirsiniz? TÜFE ve ÜFE verilerine göre ücretsiz eksik kira hesaplama aracı. Yasal kira artış oranları ile eksik kira tutarını hesaplayın.">
    <meta name="keywords" content="eksik kira hesaplayıcı, eksik kira hesaplama, kira farkı hesaplama, kira artışı hesaplama, TÜFE kira artışı, ev sahibi hakları, kira artış oranı 2025">
    <meta name="author" content="Eyüpoğlu & Işıkgör Hukuk Bürosu">
    <meta name="robots" content="index, follow">
    <meta name="language" content="tr">
    <meta name="revisit-after" content="7 days">
    
    <!-- Canonical URL -->
    <link rel="canonical" href="https://eievdanismanligi.com/pages/eksik-kira-hesaplayici.html">
    
    <!-- Open Graph Tags -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://eievdanismanligi.com/pages/eksik-kira-hesaplayici.html">
    <meta property="og:title" content="Eksik Kira Hesaplayıcısı 2025 - Ücretsiz Kira Hesaplama Aracı">
    <meta property="og:description" content="Kiracınızdan ne kadar eksik kira alabilirsiniz? TÜFE ve ÜFE verilerine göre ücretsiz eksik kira hesaplama aracı.">
    <meta property="og:image" content="https://eievdanismanligi.com/assets/images/logo.png">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:site_name" content="Ev Sahibi Danışmanlığı">
    <meta property="og:locale" content="tr_TR">
    
    <!-- Twitter Card Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="https://eievdanismanligi.com/pages/eksik-kira-hesaplayici.html">
    <meta name="twitter:title" content="Eksik Kira Hesaplayıcısı 2025 - Ücretsiz Kira Hesaplama Aracı">
    <meta name="twitter:description" content="Kiracınızdan ne kadar eksik kira alabilirsiniz? TÜFE ve ÜFE verilerine göre ücretsiz eksik kira hesaplama aracı.">
    <meta name="twitter:image" content="https://eievdanismanligi.com/assets/images/logo.png">
    
    <!-- Additional Meta Tags -->
    <meta name="theme-color" content="#B8860B">
    <meta name="msapplication-TileColor" content="#B8860B">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Eksik Kira Hesaplayıcısı">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="../assets/images/favicon.ico">
    <link rel="apple-touch-icon" sizes="180x180" href="../assets/images/logo.png">
    <link rel="icon" type="image/png" sizes="32x32" href="../assets/images/logo.png">
    <link rel="icon" type="image/png" sizes="16x16" href="../assets/images/logo.png">
    
    <!-- Preconnect for Performance -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    <link rel="preload" href="../assets/images/logo.png" as="image">
    
    <!-- Google Analytics - Gerçek ID ile değiştirilecek -->
    <!-- <script async src="https://www.googletagmanager.com/gtag/js?id=G-Y4N18Q5M25G"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-Y4N18Q5M25G');
    </script> -->
    
    <!-- Google Search Console - Gerçek verification code ile değiştirilecek -->
    <!-- <meta name="google-site-verification" content="YOUR_VERIFICATION_CODE" /> -->
    
    <!-- Structured Data -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "Eksik Kira Hesaplayıcısı",
        "description": "Kiracınızdan ne kadar eksik kira alabilirsiniz? TÜFE ve ÜFE verilerine göre ücretsiz eksik kira hesaplama aracı. Yasal kira artış oranları ile eksik kira tutarını hesaplayın.",
        "url": "https://eievdanismanligi.com/pages/eksik-kira-hesaplayici.html",
        "applicationCategory": "FinanceApplication",
        "operatingSystem": "Web Browser",
        "browserRequirements": "Güncel web tarayıcısı",
        "offers": {
            "@type": "Offer",
            "price": "0",
            "priceCurrency": "TRY",
            "description": "Ücretsiz eksik kira hesaplama aracı"
        },
        "provider": {
            "@type": "LegalService",
            "name": "Ev Sahibi Danışmanlığı",
            "url": "https://eievdanismanligi.com",
            "telephone": "+905334222595",
            "address": {
                "@type": "PostalAddress",
                "addressCountry": "TR",
                "addressLocality": "İstanbul"
            }
        },
        "featureList": [
            "TÜFE bazlı eksik kira hesaplama",
            "ÜFE verilerine göre kira farkı hesaplama",
            "Çok yıllık eksik kira hesaplama",
            "Excel raporu oluşturma",
            "Yasal kira artış oranları",
            "Konut ve işyeri ayrımı",
            "Gerçek TÜİK verileri"
        ],
        "screenshot": "https://eievdanismanligi.com/assets/images/eksik-kira-hesaplayici-screenshot.png",
        "dateCreated": "2025-01-13",
        "dateModified": "2025-01-13",
        "author": {
            "@type": "Organization",
            "name": "Eyüpoğlu & Işıkgör Hukuk Bürosu",
            "url": "https://eievdanismanligi.com"
        },
        "inLanguage": "tr-TR",
        "isAccessibleForFree": true,
        "license": "https://eievdanismanligi.com/terms"
    }
    </script>

    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script async src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        /* Navbar Styles */
        .navbar {
            background: white;
            padding: 12px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
        }

        .nav-logo img {
            max-height: 130px;
            width: auto;
            max-width: 260px;
            display: block;
            margin: -15px auto 0 auto;
        }

        .nav-menu {
            display: flex;
            list-style: none;
            gap: 40px;
        }

        .nav-menu a {
            text-decoration: none;
            color: #475569;
            font-weight: 500;
            font-size: 15px;
            transition: color 0.3s ease;
        }

        .nav-menu a:hover {
            color: #0f172a;
        }

        .nav-menu a.active {
            color: #B8860B;
            font-weight: 600;
        }

        /* Mobile Menu Styles */
        .mobile-menu-btn {
            display: none;
            flex-direction: column;
            cursor: pointer;
            padding: 12px;
            border-radius: 6px;
            transition: background 0.3s ease;
            min-height: 48px;
            min-width: 48px;
            justify-content: center;
            align-items: center;
        }

        .mobile-menu-btn span {
            width: 25px;
            height: 3px;
            background: #475569;
            margin: 3px 0;
            transition: 0.3s;
            border-radius: 2px;
        }

        .mobile-menu {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .mobile-menu.active {
            display: block;
            opacity: 1;
            visibility: visible;
        }

        .mobile-menu-content {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            background: white;
            border-top: 1px solid #e2e8f0;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            transform: translateY(-100%);
            transition: transform 0.3s ease;
        }

        .mobile-menu.active .mobile-menu-content {
            transform: translateY(0);
        }

        .mobile-nav-menu {
            list-style: none;
            padding: 20px 30px;
        }

        .mobile-nav-menu li {
            margin-bottom: 15px;
        }

        .mobile-nav-menu a {
            display: block;
            text-decoration: none;
            color: #475569;
            font-weight: 500;
            font-size: 16px;
            padding: 16px 20px;
            border-radius: 8px;
            transition: all 0.3s ease;
            min-height: 48px;
            display: flex;
            align-items: center;
        }

        .mobile-nav-menu a.active {
            color: #B8860B;
            background: rgba(184, 134, 11, 0.1);
            font-weight: 600;
        }

        @media (max-width: 768px) {
            .desktop-menu {
                display: none;
            }

            .mobile-menu-btn {
                display: flex;
            }

            .navbar { padding: 6px 0; }
            .nav-logo { height: 56px; }
            .nav-logo img { height: 72px; max-height: 72px; max-width: 140px; margin: -8px auto 0 auto; }
            .nav-menu { gap: 20px; }
        }

        /* Main Container */
        .main-container {
            min-height: 100vh;
            padding: 120px 30px 80px;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        /* Page Header */
        .page-header {
            text-align: center;
            margin-bottom: 60px;
        }

        .page-badge {
            background: linear-gradient(135deg, #B8860B, #DAA520);
            color: white;
            padding: 8px 20px;
            border-radius: 25px;
            font-size: 14px;
            font-weight: 500;
            display: inline-block;
            margin-bottom: 20px;
            letter-spacing: 0.5px;
        }

        .page-title {
            font-family: 'Playfair Display', serif;
            font-size: clamp(36px, 4vw, 48px);
            font-weight: 700;
            color: #0f172a;
            margin-bottom: 15px;
            line-height: 1.2;
        }

        .page-subtitle {
            font-size: 18px;
            color: #64748b;
            max-width: 600px;
            margin: 0 auto;
        }

        /* Calculator Card */
        .calculator-card {
            background: white;
            border-radius: 24px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
            border: 1px solid #e2e8f0;
            margin-bottom: 40px;
        }

        .calculator-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .calculator-icon {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #B8860B, #DAA520);
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            font-size: 32px;
            color: white;
            box-shadow: 0 8px 25px rgba(184, 134, 11, 0.3);
        }

        .calculator-title {
            font-size: 24px;
            font-weight: 700;
            color: #0f172a;
            margin-bottom: 10px;
        }

        .calculator-desc {
            color: #64748b;
            font-size: 16px;
        }

        /* Form Styles */
        .form-section {
            margin-bottom: 40px;
        }

        .form-section h3 {
            color: #0f172a;
            margin-bottom: 25px;
            font-size: 20px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .form-section h3 i {
            color: #B8860B;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group.full-width {
            grid-column: 1 / -1;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #0f172a;
            font-size: 14px;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 16px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            font-size: 16px;
            font-family: 'Inter', sans-serif;
            min-height: 44px;
            transition: all 0.3s ease;
            background: white;
        }

        .form-group input:focus,
        .form-group select:focus {
            border-color: #B8860B;
            outline: 2px solid #B8860B;
            outline-offset: 2px;
            box-shadow: 0 0 0 3px rgba(184, 134, 11, 0.1);
        }

        .form-group select {
            cursor: pointer;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m6 8 4 4 4-4'/%3e%3c/svg%3e");
            background-position: right 12px center;
            background-repeat: no-repeat;
            background-size: 16px;
            padding-right: 40px;
            appearance: none;
        }

        .help-text {
            font-size: 12px;
            color: #64748b;
            margin-top: 4px;
        }

        /* Buttons */
        .btn {
            background: linear-gradient(135deg, #B8860B, #DAA520);
            color: white;
            padding: 18px 40px;
            border: none;
            border-radius: 12px;
            font-weight: 600;
            font-size: 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            min-height: 48px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 20px rgba(184, 134, 11, 0.3);
            text-decoration: none;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(184, 134, 11, 0.4);
        }

        .btn:focus {
            outline: 2px solid #fff;
            outline-offset: 2px;
            box-shadow: 0 0 0 4px rgba(184, 134, 11, 0.3);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #64748b, #475569);
            box-shadow: 0 4px 20px rgba(100, 116, 139, 0.3);
        }

        .btn-secondary:hover {
            box-shadow: 0 8px 30px rgba(100, 116, 139, 0.4);
        }

        .btn-group {
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        /* Year Form Styling */
        .year-form {
            background: #f8fafc;
            padding: 25px;
            border-radius: 16px;
            margin-bottom: 20px;
            border: 1px solid #e2e8f0;
        }

        .year-form h4 {
            color: #0f172a;
            margin-bottom: 20px;
            font-size: 18px;
            font-weight: 600;
        }

        /* Results Panel */
        .result-panel {
            background: white;
            border-radius: 24px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
            border: 1px solid #e2e8f0;
            display: none;
        }

        .result-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .result-icon {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #10b981, #059669);
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            font-size: 32px;
            color: white;
            box-shadow: 0 8px 25px rgba(16, 185, 129, 0.3);
        }

        .result-title {
            font-size: 24px;
            font-weight: 700;
            color: #0f172a;
            margin-bottom: 10px;
        }

        .result-desc {
            color: #64748b;
            font-size: 16px;
        }

        /* Summary Cards */
        .summary-cards {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr;
            gap: 25px;
            margin-bottom: 40px;
        }

        .summary-card {
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            border: 1px solid #e2e8f0;
        }

        .summary-card.main {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            border: none;
            box-shadow: 0 8px 25px rgba(16, 185, 129, 0.3);
        }

        .summary-card.secondary {
            background: #f8fafc;
            color: #0f172a;
        }

        .summary-card h4 {
            font-size: 14px;
            margin-bottom: 12px;
            opacity: 0.8;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .summary-card .amount {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .summary-card.main .amount {
            font-size: 28px;
        }

        .summary-card p {
            font-size: 12px;
            opacity: 0.7;
            margin: 0;
        }

        /* Results Table */
        .results-table {
            overflow-x: auto;
            border-radius: 16px;
            border: 1px solid #e2e8f0;
            margin-bottom: 30px;
        }

        .results-table table {
            width: 100%;
            border-collapse: collapse;
        }

        .results-table th,
        .results-table td {
            padding: 16px;
            text-align: left;
            border-bottom: 1px solid #f1f5f9;
        }

        .results-table th {
            background: #f8fafc;
            font-weight: 600;
            font-size: 14px;
            color: #475569;
        }

        .results-table td {
            font-size: 14px;
            color: #0f172a;
        }

        .results-table tbody tr:hover {
            background: #f8fafc;
        }

        .positive {
            color: #059669;
            font-weight: 600;
        }

        .negative {
            color: #dc2626;
            font-weight: 600;
        }

        .tfoot-total {
            background: linear-gradient(135deg, #0f172a, #1e293b);
            color: white;
            font-weight: 700;
            font-size: 16px;
        }

        .tfoot-total td {
            color: white;
        }

        /* Export Section */
        .export-section {
            display: flex;
            gap: 15px;
            justify-content: center;
            align-items: center;
            padding-top: 25px;
            border-top: 1px solid #e2e8f0;
        }

        .hidden {
            display: none !important;
        }

        /* Tablet Styles */
        @media (max-width: 1024px) {
            .main-container {
                padding: 110px 25px 70px;
            }

            .container {
                max-width: 700px;
            }

            .summary-cards {
                grid-template-columns: 1fr 1fr;
                gap: 20px;
            }

            .summary-card.main {
                grid-column: 1 / -1;
            }
        }

        /* Mobile Styles */
        @media (max-width: 768px) {
            .main-container {
                padding: 100px 15px 60px;
            }

            .calculator-card,
            .result-panel {
                padding: 20px;
                border-radius: 20px;
            }

            .page-header {
                margin-bottom: 40px;
            }

            .page-badge {
                padding: 6px 16px;
                font-size: 13px;
                margin-bottom: 15px;
            }

            .page-title {
                font-size: 28px;
                margin-bottom: 12px;
            }

            .page-subtitle {
                font-size: 16px;
            }

            .calculator-header {
                margin-bottom: 30px;
            }

            .calculator-icon {
                width: 60px;
                height: 60px;
                font-size: 24px;
                margin-bottom: 15px;
            }

            .calculator-title {
                font-size: 20px;
                margin-bottom: 8px;
            }

            .calculator-desc {
                font-size: 14px;
            }

            .form-section h3 {
                font-size: 18px;
                margin-bottom: 20px;
            }

            .form-row {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .form-group {
                margin-bottom: 20px;
            }

            .form-group input,
            .form-group select {
                padding: 14px;
                font-size: 16px; /* iOS zoom önleme */
            }

            .help-text {
                font-size: 11px;
            }

            .btn {
                padding: 16px 30px;
                font-size: 15px;
                width: 100%;
            }

            .btn-group {
                flex-direction: column;
                gap: 12px;
            }

            .year-form {
                padding: 20px;
                border-radius: 14px;
            }

            .year-form h4 {
                font-size: 16px;
                margin-bottom: 15px;
            }

            /* Results Mobile */
            .result-header {
                margin-bottom: 30px;
            }

            .result-icon {
                width: 60px;
                height: 60px;
                font-size: 24px;
                margin-bottom: 15px;
            }

            .result-title {
                font-size: 20px;
                margin-bottom: 8px;
            }

            .result-desc {
                font-size: 14px;
            }

            .summary-cards {
                grid-template-columns: 1fr;
                gap: 15px;
                margin-bottom: 30px;
            }

            .summary-card {
                padding: 20px;
                border-radius: 16px;
            }

            .summary-card h4 {
                font-size: 12px;
                margin-bottom: 8px;
            }

            .summary-card .amount {
                font-size: 20px;
            }

            .summary-card.main .amount {
                font-size: 24px;
            }

            .summary-card p {
                font-size: 11px;
            }

            /* Mobile Table */
            .results-table {
                border-radius: 12px;
                font-size: 12px;
            }

            .results-table th,
            .results-table td {
                padding: 10px 8px;
                font-size: 11px;
            }

            .results-table th {
                font-size: 10px;
            }

            .export-section {
                flex-direction: column;
                gap: 12px;
            }
        }

        /* Small Mobile Styles */
        @media (max-width: 480px) {
            .main-container {
                padding: 95px 10px 50px;
            }

            .calculator-card,
            .result-panel {
                padding: 15px;
                border-radius: 18px;
            }

            .page-title {
                font-size: 24px;
            }

            .page-subtitle {
                font-size: 14px;
            }

            .form-section h3 {
                font-size: 16px;
            }

            .year-form {
                padding: 15px;
            }

            .summary-card {
                padding: 15px;
            }

            .results-table {
                font-size: 10px;
            }

            .results-table th,
            .results-table td {
                padding: 8px 4px;
                font-size: 9px;
            }

            /* Horizontal scroll for table on very small screens */
            .results-table {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }

            .results-table table {
                min-width: 600px;
            }
        }

        /* High DPI / Retina Display Optimization */
        @media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
            .calculator-icon,
            .result-icon {
                box-shadow: 0 8px 25px rgba(184, 134, 11, 0.4);
            }
        }

        /* Landscape Mobile */
        @media screen and (max-height: 500px) and (orientation: landscape) {
            .main-container {
                padding: 80px 15px 40px;
            }

            .page-header {
                margin-bottom: 25px;
            }

            .calculator-header {
                margin-bottom: 20px;
            }
        }

        /* Touch Device Optimizations */
        @media (hover: none) and (pointer: coarse) {
            .btn {
                min-height: 48px; /* Apple HIG minimum touch target */
                padding: 16px 20px;
            }

            .form-group input,
            .form-group select {
                min-height: 48px;
                padding: 16px;
            }

            /* Better tap targets for mobile */
            .mobile-nav-menu a {
                min-height: 48px;
                padding: 16px 20px;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <a href="../index.html" style="display: block;">
                    <img src="../assets/images/logo.png" alt="Eyüpoğlu & Işıkgör Logo">
                </a>
            </div>
            
            <!-- Desktop Menu -->
            <ul class="nav-menu desktop-menu">
                <li><a href="../index.html">Ana Sayfa</a></li>
                <li><a href="calculator.html">Kira Artış Hesaplayıcı</a></li>
                <li><a href="eksik-kira-hesaplayici.html" class="active">Eksik Kira Hesaplayıcı</a></li>
                <li><a href="tracking.html">Kira Takip Sistemi</a></li>
                <li><a href="knowledge.html">Bilgi Merkezi</a></li>
                <li><a href="contact.html">İletişim</a></li>
            </ul>
            
            <!-- Mobile Menu Button -->
            <div class="mobile-menu-btn" aria-label="Menüyü aç/kapat" aria-expanded="false" role="button" tabindex="0">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
        
        <!-- Mobile Menu -->
        <div class="mobile-menu">
            <div class="mobile-menu-content">
                <ul class="mobile-nav-menu">
                    <li><a href="../index.html">Ana Sayfa</a></li>
                    <li><a href="calculator.html">Kira Artış Hesaplayıcı</a></li>
                    <li><a href="eksik-kira-hesaplayici.html" class="active">Eksik Kira Hesaplayıcı</a></li>
                    <li><a href="tracking.html">Kira Takip Sistemi</a></li>
                    <li><a href="knowledge.html">Bilgi Merkezi</a></li>
                    <li><a href="contact.html">İletişim</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="main-container">
        <div class="container">
            <!-- Page Header -->
            <div class="page-header">
                <div class="page-badge">
                    <i class="fas fa-calculator"></i> Ücretsiz Araç
                </div>
                <h1 class="page-title">Eksik Kira Hesaplayıcısı</h1>
                <p class="page-subtitle">Kiracınızdan ne kadar eksik kira alabilirsiniz? Sözleşme tarihinden itibaren yasal maksimum kira artışlarını hesaplayın.</p>
            </div>

            <!-- Calculator Card -->
            <div class="calculator-card">
                <div class="calculator-header">
                    <div class="calculator-icon">
                        <i class="fas fa-calculator"></i>
                    </div>
                    <h2 class="calculator-title">Eksik Kira Hesaplama</h2>
                    <p class="calculator-desc">Sözleşme bilgilerinizi girin ve kiracınızdan talep edebileceğiniz eksik kira miktarını öğrenin.</p>
                </div>

                <!-- Temel Bilgiler -->
                <div class="form-section">
                    <h3><i class="fas fa-file-contract"></i> Sözleşme Bilgileri</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="contractDate">Sözleşme Başlangıç Tarihi</label>
                            <input type="date" id="contractDate" required 
                                   aria-label="Kira sözleşmesinin başlangıç tarihini seçin"
                                   aria-describedby="contractDateHelp">
                            <div class="help-text" id="contractDateHelp">Kira sözleşmenizin başladığı tarihi seçin</div>
                        </div>
                        <div class="form-group">
                            <label for="initialRent">Başlangıç Aylık Kira (₺)</label>
                            <input type="number" id="initialRent" step="0.01" required placeholder="5.000"
                                   aria-label="Sözleşmede belirlenen başlangıç kira miktarını girin"
                                   aria-describedby="initialRentHelp">
                            <div class="help-text" id="initialRentHelp">Sözleşmede belirlenen ilk kira tutarı</div>
                        </div>
                    </div>
                    <div class="form-group full-width">
                        <label for="propertyType">Gayrimenkul Türü</label>
                        <select id="propertyType" required 
                                aria-label="Kiraladığınız gayrimenkulün türünü seçin"
                                aria-describedby="propertyTypeHelp">
                            <option value="">Gayrimenkul türünü seçin</option>
                            <option value="konut">Konut (Mesken)</option>
                            <option value="isyeri">İşyeri (Ticari)</option>
                            <option value="other">Diğer</option>
                        </select>
                        <div class="help-text" id="propertyTypeHelp">Konut için özel yasal sınırlar geçerli olabilir</div>
                    </div>
                    <button type="button" class="btn" onclick="nextStep()" 
                            aria-label="Ödeme bilgileri adımına geç">
                        <i class="fas fa-arrow-right"></i> Devam Et
                    </button>
                </div>

                <!-- Yıllık Ödeme Bilgileri -->
                <div id="paymentSection" class="form-section hidden">
                    <h3><i class="fas fa-money-bill-wave"></i> Kiracının Ödeme Bilgileri</h3>
                    <div id="yearlyPayments">
                        <!-- Dinamik olarak yıllık formlar buraya gelecek -->
                    </div>
                    <div class="btn-group">
                        <button type="button" class="btn btn-secondary" onclick="prevStep()">
                            <i class="fas fa-arrow-left"></i> Geri
                        </button>
                        <button type="button" class="btn" onclick="calculateMissingRent()">
                            <i class="fas fa-calculator"></i> Hesapla
                        </button>
                    </div>
                </div>
            </div>

            <!-- Sonuçlar -->
            <div class="result-panel" id="results">
                <div class="result-header">
                    <div class="result-icon">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <h2 class="result-title">Hesaplama Sonuçları</h2>
                    <p class="result-desc">Kiracınızdan talep edebileceğiniz eksik kira miktarı</p>
                </div>
                
                <div class="summary-cards">
                    <div class="summary-card main">
                        <h4>Toplam Eksik Kira</h4>
                        <div class="amount" id="totalMissing">₺0</div>
                        <p>Kiracınızdan talep edebileceğiniz tutar</p>
                    </div>
                    <div class="summary-card secondary">
                        <h4>Olması Gereken Toplam</h4>
                        <div class="amount" id="totalExpected">₺0</div>
                    </div>
                    <div class="summary-card secondary">
                        <h4>Ödenen Toplam</h4>
                        <div class="amount" id="totalPaid">₺0</div>
                    </div>
                </div>

                <div class="results-table">
                    <table>
                        <thead>
                            <tr>
                                <th>Yıl</th>
                                <th>Sözl. Oran</th>
                                <th>Maks. Yasal</th>
                                <th>Beklenen</th>
                                <th>Ödenen</th>
                                <th>Aylık Fark</th>
                                <th>Yıllık Fark</th>
                            </tr>
                        </thead>
                        <tbody id="resultsBody">
                            <!-- Dinamik sonuçlar -->
                        </tbody>
                        <tfoot>
                            <tr class="tfoot-total">
                                <td colspan="6">TOPLAM EKSİK KİRA:</td>
                                <td id="footerTotal" class="positive">₺0</td>
                            </tr>
                        </tfoot>
                    </table>
                </div>

                <div class="export-section">
                    <button type="button" class="btn" onclick="exportResults()">
                        <i class="fas fa-download"></i> Excel Raporu İndir
                    </button>
                    <button type="button" class="btn btn-secondary" onclick="resetCalculator()">
                        <i class="fas fa-refresh"></i> Yeni Hesaplama
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // TÜFE 12 aylık ortalama verileri (gerçek TÜİK verileri)
        const tufeRates = {
            2012: { '01': 9.22, '02': 10.12, '03': 10.45, '04': 10.55, '05': 9.97, '06': 9.35, '07': 8.89, '08': 8.56, '09': 8.29, '10': 8.17, '11': 7.80, '12': 6.99 },
            2013: { '01': 6.51, '02': 6.13, '03': 6.13, '04': 6.15, '05': 6.65, '06': 7.14, '07': 7.48, '08': 7.72, '09': 7.60, '10': 7.59, '11': 7.48, '12': 7.49 },
            2014: { '01': 7.72, '02': 7.77, '03': 8.03, '04': 8.34, '05': 8.76, '06': 8.94, '07': 8.85, '08': 8.99, '09': 8.97, '10': 8.90, '11': 8.81, '12': 8.85 },
            2015: { '01': 8.80, '02': 8.57, '03': 8.24, '04': 7.97, '05': 7.84, '06': 7.89, '07': 7.94, '08': 7.86, '09': 7.86, '10': 7.71, '11': 7.57, '12': 7.67 },
            2016: { '01': 7.86, '02': 8.46, '03': 8.31, '04': 7.78, '05': 7.47, '06': 7.33, '07': 7.59, '08': 7.89, '09': 7.84, '10': 7.77, '11': 7.46, '12': 7.78 },
            2017: { '01': 8.39, '02': 9.18, '03': 10.39, '04': 10.96, '05': 10.90, '06': 10.85, '07': 10.68, '08': 10.75, '09': 11.02, '10': 11.90, '11': 12.98, '12': 11.92 },
            2018: { '01': 10.42, '02': 10.26, '03': 10.23, '04': 10.85, '05': 12.15, '06': 15.39, '07': 15.85, '08': 17.90, '09': 24.52, '10': 25.24, '11': 21.62, '12': 20.30 },
            2019: { '01': 19.67, '02': 19.67, '03': 19.71, '04': 19.50, '05': 18.71, '06': 16.65, '07': 16.86, '08': 15.01, '09': 9.26, '10': 8.55, '11': 10.56, '12': 11.84 },
            2020: { '01': 12.15, '02': 12.37, '03': 11.86, '04': 10.94, '05': 11.39, '06': 11.76, '07': 11.76, '08': 11.77, '09': 11.75, '10': 11.89, '11': 14.03, '12': 14.60 },
            2021: { '01': 14.97, '02': 15.61, '03': 16.19, '04': 17.14, '05': 16.59, '06': 17.53, '07': 18.95, '08': 19.25, '09': 19.58, '10': 19.89, '11': 21.31, '12': 36.08 },
            2022: { '01': 48.69, '02': 54.44, '03': 61.14, '04': 69.97, '05': 73.50, '06': 78.62, '07': 79.60, '08': 80.21, '09': 83.45, '10': 85.51, '11': 84.39, '12': 64.27 },
            2023: { '01': 57.68, '02': 55.18, '03': 50.51, '04': 43.68, '05': 39.59, '06': 38.21, '07': 47.83, '08': 58.94, '09': 61.53, '10': 61.36, '11': 61.98, '12': 64.77 },
            2024: { '01': 57.68, '02': 59.94, '03': 61.98, '04': 62.25, '05': 61.78, '06': 60.56, '07': 58.40, '08': 55.94, '09': 53.91, '10': 51.94, '11': 49.94, '12': 47.57 },
            2025: { '01': 56.35, '02': 53.83, '03': 51.26, '04': 48.73, '05': 45.80, '06': 43.23, '07': 40.00 }
        };

        // ÜFE/Yİ-ÜFE 12 aylık ortalama verileri (gerçek TÜİK verileri)
        const ufeRates = {
            2012: { '01': 12.94, '02': 11.86, '03': 10.52, '04': 9.23, '05': 8.25, '06': 7.03, '07': 5.95, '08': 5.31, '09': 4.44, '10': 3.66, '11': 3.05, '12': 2.45 },
            2013: { '01': 2.17, '02': 2.52, '03': 3.08, '04': 3.27, '05': 3.51, '06': 4.06, '07': 4.68, '08': 5.22, '09': 5.65, '10': 5.94, '11': 5.98, '12': 6.97 },
            2014: { '01': 7.84, '02': 8.57, '03': 8.86, '04': 9.01, '05': 8.95, '06': 8.95, '07': 8.68, '08': 8.51, '09': 8.37, '10': 8.36, '11': 8.61, '12': 6.36 },
            2015: { '01': 4.59, '02': 3.41, '03': 3.11, '04': 3.65, '05': 4.14, '06': 4.26, '07': 4.51, '08': 4.98, '09': 5.34, '10': 5.42, '11': 5.26, '12': 5.71 },
            2016: { '01': 6.29, '02': 6.67, '03': 6.29, '04': 5.68, '05': 5.58, '06': 5.64, '07': 5.64, '08': 5.21, '09': 4.85, '10': 4.52, '11': 4.58, '12': 5.07 },
            2017: { '01': 5.68, '02': 6.59, '03': 7.32, '04': 8.04, '05': 8.80, '06': 9.61, '07': 9.94, '08': 10.51, '09': 11.23, '10': 12.89, '11': 15.68, '12': 15.48 },
            2018: { '01': 13.79, '02': 13.12, '03': 13.57, '04': 14.12, '05': 15.28, '06': 18.54, '07': 21.40, '08': 24.40, '09': 33.28, '10': 46.15, '11': 45.01, '12': 33.64 }
        };

        // Maksimum yasal oran referansı (hesaplama için)
        const inflationRates = {
            2014: 8.85, 2015: 7.67, 2016: 7.78, 2017: 11.92, 2018: 20.30, 2019: 11.84, 2020: 14.60, 2021: 36.08, 2022: 64.27, 2023: 64.77, 2024: 47.57, 2025: 40.00
        };

        let calculationData = [];

        function getRateOptions(year, contractDate, propertyType) {
            const prevYear = year - 1;
            const contractMonth = String(contractDate.getMonth() + 1).padStart(2, '0');
            let options = '';

            // Yasal oran - dönemsel olarak belirlenir
            let legalRateText = '';
            let legalRate = 0;
            
            if (year >= 2012 && year <= 2018) {
                // 2012-2018: Konut için Yİ-ÜFE 12A ort., İşyeri için TBK 344 erteli
                if (propertyType === 'konut') {
                    if (ufeRates[prevYear] && ufeRates[prevYear][contractMonth]) {
                        legalRate = ufeRates[prevYear][contractMonth];
                        legalRateText = `Yİ-ÜFE 12A ort. (Konut)`;
                    }
                } else {
                    legalRateText = 'TBK 344 erteli (İşyeri)';
                    legalRate = 15;
                }
            } else if (year >= 2019 && year <= 2022) {
                // 2019-10.06.2022: Konut + İşyeri: TÜFE 12A ort. üst sınır yok
                if (tufeRates[prevYear] && tufeRates[prevYear][contractMonth]) {
                    legalRate = tufeRates[prevYear][contractMonth];
                    legalRateText = `TÜFE 12A ort. üst sınır yok`;
                }
            } else if (year >= 2022 && year <= 2024) {
                // 11.06.2022-01.07.2024: Konutta %25 üst sınır, İşyeri TÜFE 12A ort.
                if (tufeRates[prevYear] && tufeRates[prevYear][contractMonth]) {
                    const tufeRate = tufeRates[prevYear][contractMonth];
                    const rentIncreaseDate = new Date(contractDate);
                    rentIncreaseDate.setFullYear(year);
                    const limitStart = new Date('2022-06-11');
                    const limitEnd = new Date('2024-07-01');
                    
                    if (propertyType === 'konut' && rentIncreaseDate >= limitStart && rentIncreaseDate < limitEnd) {
                        legalRate = Math.min(tufeRate, 25);
                        legalRateText = legalRate < tufeRate ? 
                            `%25 üst sınır (TÜFE daha düşükse TÜFE)` : 
                            `TÜFE 12A ort. (Konut)`;
                    } else {
                        legalRate = tufeRate;
                        legalRateText = propertyType === 'konut' ? 
                            `TÜFE 12A ort. (Konut)` : `TÜFE 12A ort. (İşyeri)`;
                    }
                }
            } else if (year >= 2025) {
                // 02.07.2024-2025: Konut + İşyeri: TÜFE 12A ort. (geçici %25 sınırı bitti)
                if (tufeRates[prevYear] && tufeRates[prevYear][contractMonth]) {
                    legalRate = tufeRates[prevYear][contractMonth];
                    legalRateText = `TÜFE 12A ort. (geçici %25 sınırı bitti)`;
                }
            }

            // Yasal oran seçeneği ekle
            if (legalRateText && legalRate > 0) {
                options += `<option value="${legalRate}|${legalRateText}" selected>Yasal Oran: ${legalRateText} - %${legalRate.toFixed(2)}</option>`;
            }

            // Yİ-ÜFE (12 aylık ortalama) - 2018'e kadar mevcut
            if (ufeRates[prevYear] && ufeRates[prevYear][contractMonth]) {
                const rate = ufeRates[prevYear][contractMonth];
                options += `<option value="${rate}|Yİ-ÜFE (12 aylık ortalama)">Yİ-ÜFE (12 aylık ortalama) - %${rate.toFixed(2)}</option>`;
            } else {
                // 2019+ için de ÜFE seçeneği olsun (varsayılan değer)
                const defaultUfe = prevYear >= 2019 ? 15 : 10;
                options += `<option value="${defaultUfe}|Yİ-ÜFE (12 aylık ortalama)">Yİ-ÜFE (12 aylık ortalama) - %${defaultUfe.toFixed(2)} (tahmini)</option>`;
            }

            // TÜFE (bir önceki ay) - Her yıl için
            const contractMonthNum = contractDate.getMonth() + 1; // 1-12 arası
            let prevMonthForTufe, prevYearForTufe;
            if (contractMonthNum === 1) {
                prevMonthForTufe = 12;
                prevYearForTufe = year - 1;
            } else {
                prevMonthForTufe = contractMonthNum - 1;
                prevYearForTufe = year;
            }
            const prevMonthStr = String(prevMonthForTufe).padStart(2, '0');
            
            if (tufeRates[prevYearForTufe] && tufeRates[prevYearForTufe][prevMonthStr]) {
                const rate = tufeRates[prevYearForTufe][prevMonthStr];
                options += `<option value="${rate}|TÜFE (bir önceki ay)">TÜFE (bir önceki ay) - %${rate.toFixed(2)}</option>`;
            }

            // Yİ-ÜFE (Geçen yılın aynı ayına göre) - Her yıl için
            if (ufeRates[prevYear] && ufeRates[prevYear][contractMonth]) {
                const rate = ufeRates[prevYear][contractMonth];
                options += `<option value="${rate}|Yİ-ÜFE (Geçen yılın aynı ayına göre)">Yİ-ÜFE (Geçen yılın aynı ayına göre) - %${rate.toFixed(2)}</option>`;
            } else {
                const defaultUfe = prevYear >= 2019 ? 20 : 8;
                options += `<option value="${defaultUfe}|Yİ-ÜFE (Geçen yılın aynı ayına göre)">Yİ-ÜFE (Geçen yılın aynı ayına göre) - %${defaultUfe.toFixed(2)} (tahmini)</option>`;
            }

            // (TÜFE + Yİ-ÜFE)/2 (12 aylık ortalama) - Her yıl için
            if (tufeRates[prevYear] && tufeRates[prevYear][contractMonth]) {
                const tufeRate = tufeRates[prevYear][contractMonth];
                let ufeRate;
                if (ufeRates[prevYear] && ufeRates[prevYear][contractMonth]) {
                    ufeRate = ufeRates[prevYear][contractMonth];
                } else {
                    ufeRate = prevYear >= 2019 ? 15 : 8;
                }
                const avgRate = (tufeRate + ufeRate) / 2;
                options += `<option value="${avgRate}|(TÜFE + Yİ-ÜFE)/2 (12 aylık ortalama)">(TÜFE + Yİ-ÜFE)/2 (12 aylık ortalama) - %${avgRate.toFixed(2)}</option>`;
            }

            // (TÜFE + Yİ-ÜFE)/2 (Geçen yılın aynı ayına göre) - Her yıl için
            if (tufeRates[prevYear] && tufeRates[prevYear][contractMonth]) {
                const tufeRate = tufeRates[prevYear][contractMonth];
                let ufeRate;
                if (ufeRates[prevYear] && ufeRates[prevYear][contractMonth]) {
                    ufeRate = ufeRates[prevYear][contractMonth];
                } else {
                    ufeRate = prevYear >= 2019 ? 20 : 10;
                }
                const avgRate = (tufeRate + ufeRate) / 2;
                options += `<option value="${avgRate}|(TÜFE + Yİ-ÜFE)/2 (Geçen yılın aynı ayına göre)">(TÜFE + Yİ-ÜFE)/2 (Geçen yılın aynı ayına göre) - %${avgRate.toFixed(2)}</option>`;
            }

            // Özel Oran - Her zaman mevcut
            options += '<option value="custom|Özel Oran">Özel Oran</option>';

            return options;
        }

        function nextStep() {
            const contractDateEl = document.getElementById('contractDate');
            const initialRentEl = document.getElementById('initialRent');
            const propertyTypeEl = document.getElementById('propertyType');
            
            if (!contractDateEl || !initialRentEl || !propertyTypeEl) {
                alert('Form elemanları bulunamadı!');
                return;
            }
            
            const contractDate = contractDateEl.value;
            const initialRent = parseFloat(initialRentEl.value);
            const propertyType = propertyTypeEl.value;

            if (!contractDate || !initialRent || !propertyType) {
                alert('Lütfen tüm alanları doldurun!');
                return;
            }
            
            // Tarih validasyonu
            const contractDateObj = new Date(contractDate);
            const currentDate = new Date();
            if (contractDateObj >= currentDate) {
                alert('Sözleşme tarihi bugünden önceki bir tarih olmalıdır!');
                return;
            }
            
            // Kira miktarı validasyonu
            if (initialRent <= 0 || initialRent > 1000000) {
                alert('Lütfen geçerli bir kira miktarı giriniz! (0-1,000,000 TL arası)');
                return;
            }

            generateYearlyForms(new Date(contractDate), initialRent, propertyType);
            const paymentSection = document.getElementById('paymentSection');
            if (paymentSection) {
                paymentSection.classList.remove('hidden');
            }
        }

        function prevStep() {
            const paymentSection = document.getElementById('paymentSection');
            if (paymentSection) {
                paymentSection.classList.add('hidden');
            }
        }

        function generateYearlyForms(contractDate, initialRent, propertyType) {
            const container = document.getElementById('yearlyPayments');
            if (!container) {
                console.error('yearlyPayments container bulunamadı!');
                return;
            }
            container.innerHTML = '';

            const currentYear = new Date().getFullYear();
            const startYear = contractDate.getFullYear();

            for (let year = startYear; year <= currentYear; year++) {
                if (year === startYear) continue; // İlk yıl artış olmaz

                const yearDiv = document.createElement('div');
                yearDiv.className = 'year-form';
                
                const rateOptions = getRateOptions(year, contractDate, propertyType);

                yearDiv.innerHTML = `
                    <h4>${year} Yılı Kira Bilgileri</h4>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Kiracının Bu Yıl Ödediği Aylık Kira (₺)</label>
                            <input type="number" id="paid_${year}" step="0.01" required placeholder="0">
                            <div class="help-text">Kiracının ${year} yılında ödediği aylık kira tutarı</div>
                        </div>
                        <div class="form-group">
                            <label>Sözleşmenizde Yazılan Artış Oranı</label>
                            <select id="rateSelect_${year}" onchange="handleRateSelection(${year})">
                                <option value="">Artış türünü seçin...</option>
                                ${rateOptions}
                            </select>
                            <div class="help-text">Sözleşmede belirlenen kira artış oranı türü</div>
                            <div id="customRateDiv_${year}" style="display: none; margin-top: 15px;">
                                <input type="number" id="customRate_${year}" step="0.01" min="0" max="100" placeholder="Özel oran girin (%)" required>
                                <div class="help-text">Sözleşmede belirtilen özel artış oranını girin</div>
                            </div>
                            <div id="rateDiv_${year}" style="display: none; margin-top: 15px;">
                                <input type="number" id="rate_${year}" step="0.01" min="0" max="100" required readonly>
                            </div>
                        </div>
                    </div>
                `;
                
                container.appendChild(yearDiv);
            }
        }

        function handleRateSelection(year) {
            const select = document.getElementById(`rateSelect_${year}`);
            const customDiv = document.getElementById(`customRateDiv_${year}`);
            const rateDiv = document.getElementById(`rateDiv_${year}`);
            const rateInput = document.getElementById(`rate_${year}`);
            
            if (!select || !customDiv || !rateDiv || !rateInput) {
                console.error('Rate selection elemanları bulunamadı!');
                return;
            }
            
            if (select.value.startsWith('custom')) {
                customDiv.style.display = 'block';
                rateDiv.style.display = 'none';
            } else if (select.value !== '') {
                customDiv.style.display = 'none';
                rateDiv.style.display = 'block';
                const rateParts = select.value.split('|');
                const rateValue = parseFloat(rateParts[0]);
                rateInput.value = rateValue.toFixed(2);
            } else {
                customDiv.style.display = 'none';
                rateDiv.style.display = 'none';
            }
        }

        function calculateMissingRent() {
            const contractDate = new Date(document.getElementById('contractDate').value);
            const initialRent = parseFloat(document.getElementById('initialRent').value);
            const propertyType = document.getElementById('propertyType').value;

            calculationData = [];
            let totalMissing = 0;
            let totalExpected = 0;
            let totalPaid = 0;
            let baseRent = initialRent;

            const currentYear = new Date().getFullYear();
            const startYear = contractDate.getFullYear();

            for (let year = startYear; year <= currentYear; year++) {
                if (year === startYear) continue;

                const paidAmount = parseFloat(document.getElementById(`paid_${year}`).value) || 0;
                
                // Oran alma - dropdown seçimine göre
                let contractRate = 0;
                let selectedRateType = '';
                const select = document.getElementById(`rateSelect_${year}`);
                
                if (select.value.startsWith('custom')) {
                    contractRate = parseFloat(document.getElementById(`customRate_${year}`).value) || 0;
                    selectedRateType = 'Özel Oran';
                } else if (select.value !== '') {
                    const rateParts = select.value.split('|');
                    contractRate = parseFloat(rateParts[0]) || 0;
                    selectedRateType = rateParts[1] || 'Bilinmeyen';
                } else {
                    contractRate = parseFloat(document.getElementById(`rate_${year}`).value) || 0;
                    selectedRateType = 'Manuel Giriş';
                }
                
                // O yılki maksimum yasal oran hesapla (bilgi amaçlı)
                const prevYear = year - 1;
                const contractMonth = String(contractDate.getMonth() + 1).padStart(2, '0');
                let maxLegalRate = 0;
                let rateType = '';
                
                if (year <= 2018) {
                    // 2018 ve öncesi ÜFE dönemi - 12 aylık ortalama kullan
                    const ufeRate = calculateYearlyAverage(ufeRates, prevYear);
                    if (ufeRate > 0) {
                        maxLegalRate = ufeRate;
                        rateType = 'ÜFE';
                    }
                } else {
                    // 2019 ve sonrası TÜFE dönemi - 12 aylık ortalama kullan
                    const tufeRate = calculateYearlyAverage(tufeRates, prevYear);
                    
                    if (tufeRate > 0) {
                        // Konut %25 sınırı kontrolü (11 Haziran 2022 - 1 Temmuz 2024)
                        const limitStartDate = new Date('2022-06-11');
                        const limitEndDate = new Date('2024-07-01');
                        const checkDate = new Date(contractDate);
                        checkDate.setFullYear(year);
                        
                        if (propertyType === 'konut' && checkDate >= limitStartDate && checkDate < limitEndDate) {
                            maxLegalRate = Math.min(tufeRate, 25);
                            rateType = maxLegalRate < tufeRate ? '%25 Sınırı' : 'TÜFE';
                        } else {
                            maxLegalRate = tufeRate;
                            rateType = 'TÜFE';
                        }
                    }
                }
                
                if (maxLegalRate === 0) {
                    maxLegalRate = 25;
                    rateType = 'Varsayılan';
                }
                
                const expectedRent = Math.round(baseRent * (1 + contractRate / 100) * 100) / 100;
                const monthlyDiff = Math.max(0, expectedRent - paidAmount);
                const yearlyDiff = monthlyDiff * 12; // Her zaman 12 ay

                totalMissing += yearlyDiff;
                totalExpected += expectedRent * 12;
                totalPaid += paidAmount * 12;

                calculationData.push({
                    year,
                    contractRate,
                    selectedRateType, // Seçilen oran türü (dropdown'dan)
                    maxLegalRate, // O yılki en fazla olabilecek oran
                    rateType, // Maks yasal oran türü (TÜFE/ÜFE/%25 Sınırı)
                    expectedRent,
                    paidAmount,
                    monthlyDiff,
                    yearlyDiff
                });

                baseRent = expectedRent; // Bir sonraki yıl için baz
            }

            displayResults(totalMissing, totalExpected, totalPaid);
        }

        function displayResults(totalMissing, totalExpected, totalPaid) {
            document.getElementById('totalMissing').textContent = formatMoney(totalMissing);
            document.getElementById('totalExpected').textContent = formatMoney(totalExpected);
            document.getElementById('totalPaid').textContent = formatMoney(totalPaid);
            document.getElementById('footerTotal').textContent = formatMoney(totalMissing);

            const tbody = document.getElementById('resultsBody');
            tbody.innerHTML = '';

            calculationData.forEach(data => {
                const row = tbody.insertRow();
                const diffClass = data.yearlyDiff > 0 ? 'positive' : 'negative';
                
                row.innerHTML = `
                    <td><strong>${data.year}</strong></td>
                    <td>%${data.contractRate.toFixed(2)} <br><small style="color: #6b7280; font-size: 0.75em;">(${data.selectedRateType})</small></td>
                    <td style="color: #6b7280; font-size: 0.9em;">%${data.maxLegalRate.toFixed(2)} <span style="font-size: 0.8em;">(${data.rateType})</span></td>
                    <td><strong>${formatMoney(data.expectedRent)}</strong></td>
                    <td>${formatMoney(data.paidAmount)}</td>
                    <td class="${diffClass}"><strong>${formatMoney(data.monthlyDiff)}</strong></td>
                    <td class="${diffClass}" style="font-size: 1.1em;"><strong>${formatMoney(data.yearlyDiff)}</strong></td>
                `;
            });

            document.getElementById('results').style.display = 'block';
            document.getElementById('results').scrollIntoView({ behavior: 'smooth' });
        }

        function formatMoney(amount) {
            return new Intl.NumberFormat('tr-TR', {
                style: 'currency',
                currency: 'TRY',
                minimumFractionDigits: 0,
                maximumFractionDigits: 0
            }).format(amount);
        }

        function exportResults() {
            generateExcel();
        }

        function generateCSV() {
            let csv = 'Yıl,Sözleşme Oranı,Seçilen Tür,Maks. Yasal,Oran Türü,Beklenen,Ödenen,Aylık Fark,Yıllık Fark\n';
            
            calculationData.forEach(data => {
                csv += `${data.year},${data.contractRate.toFixed(2)}%,${data.selectedRateType},${data.maxLegalRate.toFixed(2)}%,${data.rateType},${data.expectedRent.toFixed(2)},${data.paidAmount.toFixed(2)},${data.monthlyDiff.toFixed(2)},${data.yearlyDiff.toFixed(2)}\n`;
            });

            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'eksik-kira-hesaplama.csv';
            link.click();
        }

        function generateExcel() {
            if (!calculationData || calculationData.length === 0) {
                alert('Önce hesaplama yapınız!');
                return;
            }
            
            try {
                const totalMissing = calculationData.reduce((sum, data) => sum + data.yearlyDiff, 0);
                const totalExpected = calculationData.reduce((sum, data) => sum + (data.expectedRent * 12), 0);
                const totalPaid = calculationData.reduce((sum, data) => sum + (data.paidAmount * 12), 0);
                
                // Excel çalışma kitabı oluştur
                const wb = XLSX.utils.book_new();
            
            // Veri dizisini oluştur
            const wsData = [];
            
            // Başlık bilgileri
            wsData.push(['EKSİK KİRA HESAPLAMA RAPORU']);
            wsData.push(['Rapor Tarihi:', new Date().toLocaleDateString('tr-TR')]);
            wsData.push(['']); // Boş satır
            
            // Özet bilgileri
            wsData.push(['ÖZET BİLGİLER']);
            wsData.push(['Toplam Eksik Kira:', formatMoney(totalMissing)]);
            wsData.push(['Olması Gereken Toplam:', formatMoney(totalExpected)]);
            wsData.push(['Ödenen Toplam:', formatMoney(totalPaid)]);
            wsData.push(['']); // Boş satır
            
            // Tablo başlıkları
            wsData.push([
                'YIL',
                'SÖZLEŞMEDEKİ ORAN (%)',
                'ORAN TÜRÜ',
                'MAKS. YASAL ORAN (%)',
                'YASAL ORAN TÜRÜ',
                'BEKLENEN AYLIK KİRA (₺)',
                'ÖDENEN AYLIK KİRA (₺)',
                'AYLIK FARK (₺)',
                'YILLIK FARK (₺)'
            ]);
            
            // Veri satırları
            calculationData.forEach(data => {
                wsData.push([
                    data.year,
                    data.contractRate.toFixed(2),
                    data.selectedRateType,
                    data.maxLegalRate.toFixed(2),
                    data.rateType,
                    data.expectedRent.toFixed(0),
                    data.paidAmount.toFixed(0),
                    data.monthlyDiff.toFixed(0),
                    data.yearlyDiff.toFixed(0)
                ]);
            });
            
            // Toplam satırı
            wsData.push(['']); // Boş satır
            wsData.push([
                'TOPLAM',
                '', '', '', '',
                '',
                '',
                '',
                totalMissing.toFixed(0)
            ]);
            
            // Çalışma sayfası oluştur
            const ws = XLSX.utils.aoa_to_sheet(wsData);
            
            // Sütun genişliklerini ayarla (her şey net görünsün)
            ws['!cols'] = [
                { wch: 8 },  // YIL
                { wch: 18 }, // SÖZLEŞMEDEKİ ORAN
                { wch: 25 }, // ORAN TÜRÜ
                { wch: 18 }, // MAKS. YASAL ORAN
                { wch: 15 }, // YASAL ORAN TÜRÜ
                { wch: 20 }, // BEKLENEN KİRA
                { wch: 18 }, // ÖDENEN KİRA
                { wch: 15 }, // AYLIK FARK
                { wch: 15 }  // YILLIK FARK
            ];
            
            // Hücre stillerini ayarla
            const headerRow = 9; // Tablo başlık satırı
            const dataStartRow = 10; // Veri başlangıç satırı
            
            // Başlık satırı stil
            for (let col = 0; col < 9; col++) {
                const cellRef = XLSX.utils.encode_cell({ r: headerRow, c: col });
                if (!ws[cellRef]) ws[cellRef] = { t: 's', v: '' };
                ws[cellRef].s = {
                    font: { bold: true, color: { rgb: 'FFFFFF' } },
                    fill: { fgColor: { rgb: '4F46E5' } },
                    alignment: { horizontal: 'center', vertical: 'center' },
                    border: {
                        top: { style: 'thin', color: { rgb: '000000' } },
                        bottom: { style: 'thin', color: { rgb: '000000' } },
                        left: { style: 'thin', color: { rgb: '000000' } },
                        right: { style: 'thin', color: { rgb: '000000' } }
                    }
                };
            }
            
            // Veri satırları stil
            for (let row = dataStartRow; row < dataStartRow + calculationData.length; row++) {
                for (let col = 0; col < 9; col++) {
                    const cellRef = XLSX.utils.encode_cell({ r: row, c: col });
                    if (!ws[cellRef]) ws[cellRef] = { t: 's', v: '' };
                    
                    ws[cellRef].s = {
                        font: { size: 11 },
                        alignment: { horizontal: 'center', vertical: 'center' },
                        border: {
                            top: { style: 'thin', color: { rgb: 'CCCCCC' } },
                            bottom: { style: 'thin', color: { rgb: 'CCCCCC' } },
                            left: { style: 'thin', color: { rgb: 'CCCCCC' } },
                            right: { style: 'thin', color: { rgb: 'CCCCCC' } }
                        }
                    };
                    
                    // Zebra çizgiler
                    if ((row - dataStartRow) % 2 === 0) {
                        ws[cellRef].s.fill = { fgColor: { rgb: 'F9FAFB' } };
                    }
                    
                    // Fark sütunları için renklendirme
                    if (col === 7 || col === 8) { // Aylık fark ve yıllık fark
                        const value = parseFloat(wsData[row][col]);
                        if (value > 0) {
                            ws[cellRef].s.font = { color: { rgb: '059669' }, bold: true };
                        } else if (value < 0) {
                            ws[cellRef].s.font = { color: { rgb: 'DC2626' }, bold: true };
                        }
                    }
                }
            }
            
            // Toplam satırı stil
            const totalRow = dataStartRow + calculationData.length + 1;
            for (let col = 0; col < 9; col++) {
                const cellRef = XLSX.utils.encode_cell({ r: totalRow, c: col });
                if (!ws[cellRef]) ws[cellRef] = { t: 's', v: '' };
                ws[cellRef].s = {
                    font: { bold: true, color: { rgb: 'FFFFFF' }, size: 12 },
                    fill: { fgColor: { rgb: '4F46E5' } },
                    alignment: { horizontal: 'center', vertical: 'center' },
                    border: {
                        top: { style: 'thick', color: { rgb: '000000' } },
                        bottom: { style: 'thick', color: { rgb: '000000' } },
                        left: { style: 'thick', color: { rgb: '000000' } },
                        right: { style: 'thick', color: { rgb: '000000' } }
                    }
                };
            }
            
            // Başlık stili
            const titleCellRef = XLSX.utils.encode_cell({ r: 0, c: 0 });
            ws[titleCellRef].s = {
                font: { bold: true, size: 16, color: { rgb: '4F46E5' } },
                alignment: { horizontal: 'center' }
            };
            
            // Özet başlık stili
            const summaryTitleRef = XLSX.utils.encode_cell({ r: 3, c: 0 });
            ws[summaryTitleRef].s = {
                font: { bold: true, size: 12, color: { rgb: '059669' } },
                alignment: { horizontal: 'left' }
            };
            
                // Çalışma kitabına sayfa ekle
                XLSX.utils.book_append_sheet(wb, ws, 'Eksik Kira Raporu');
                
                // Excel dosyasını indir
                XLSX.writeFile(wb, 'eksik-kira-raporu.xlsx');
                
                // Memory cleanup
                wsData.length = 0;
                
            } catch (error) {
                console.error('Excel export hatası:', error);
                alert('Excel dosyası oluşturulurken bir hata oluştu. Lütfen tekrar deneyin.');
            }
        }
        
        function formatMoneySimple(amount) {
            return new Intl.NumberFormat('tr-TR', {
                style: 'currency',
                currency: 'TRY',
                minimumFractionDigits: 0,
                maximumFractionDigits: 0
            }).format(amount).replace('₺', '₺');
        }

        function resetCalculator() {
            location.reload();
        }

        // Mobile Menu JavaScript
        document.addEventListener('DOMContentLoaded', function() {
            const mobileMenuBtn = document.querySelector('.mobile-menu-btn');
            const mobileMenu = document.querySelector('.mobile-menu');
            
            if (mobileMenuBtn && mobileMenu) {
                mobileMenuBtn.addEventListener('click', function() {
                    mobileMenu.classList.toggle('active');
                    mobileMenuBtn.classList.toggle('active');
                    
                    // Prevent body scroll when menu is open
                    if (mobileMenu.classList.contains('active')) {
                        document.body.style.overflow = 'hidden';
                    } else {
                        document.body.style.overflow = '';
                    }
                });
                
                mobileMenu.addEventListener('click', function(e) {
                    if (e.target === mobileMenu) {
                        mobileMenu.classList.remove('active');
                        mobileMenuBtn.classList.remove('active');
                        document.body.style.overflow = '';
                    }
                });
                
                // Close menu on link click
                const menuLinks = mobileMenu.querySelectorAll('a');
                menuLinks.forEach(link => {
                    link.addEventListener('click', function() {
                        mobileMenu.classList.remove('active');
                        mobileMenuBtn.classList.remove('active');
                        document.body.style.overflow = '';
                    });
                });
                
                // Handle window resize
                window.addEventListener('resize', function() {
                    if (window.innerWidth > 768) {
                        mobileMenu.classList.remove('active');
                        mobileMenuBtn.classList.remove('active');
                        document.body.style.overflow = '';
                    }
                });
            }
            
            // Mobile form improvements
            const inputs = document.querySelectorAll('input, select');
            inputs.forEach(input => {
                input.addEventListener('focus', function() {
                    // Scroll input into view on mobile
                    if (window.innerWidth <= 768) {
                        setTimeout(() => {
                            this.scrollIntoView({ 
                                behavior: 'smooth', 
                                block: 'center' 
                            });
                        }, 300);
                    }
                });
            });
        });

        // Yearly average calculation function
        function calculateYearlyAverage(rates, year) {
            const yearData = rates[year];
            if (!yearData) return 0;
            
            const values = Object.values(yearData);
            return values.reduce((sum, val) => sum + val, 0) / values.length;
        }
    </script>
</body>
</html>