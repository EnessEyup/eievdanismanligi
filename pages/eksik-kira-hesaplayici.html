<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- SEO Meta Tags -->
    <title>Eksik Kira Hesaplayıcısı 2025 - Ücretsiz Kira Hesaplama Aracı | Eyüpoğlu & Işıkgör</title>
    <meta name="title" content="Eksik Kira Hesaplayıcısı 2025 - Ücretsiz Kira Hesaplama Aracı | Eyüpoğlu & Işıkgör">
    <meta name="description" content="Kiracınızdan ne kadar eksik kira alabilirsiniz? TÜFE ve ÜFE verilerine göre ücretsiz eksik kira hesaplama aracı. Yasal kira artış oranları ile eksik kira tutarını hesaplayın.">
    <meta name="keywords" content="eksik kira hesaplayıcı, eksik kira hesaplama, kira farkı hesaplama, kira artışı hesaplama, TÜFE kira artışı, ev sahibi hakları, kira artış oranı 2025">
    <meta name="author" content="Eyüpoğlu & Işıkgör Hukuk Bürosu">
    <meta name="robots" content="index, follow">
    <meta name="language" content="tr">
    <meta name="revisit-after" content="7 days">
    
    <!-- Canonical URL -->
    <link rel="canonical" href="https://eievdanismanligi.com/pages/eksik-kira-hesaplayici.html">
    
    <!-- Open Graph Tags -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://eievdanismanligi.com/pages/eksik-kira-hesaplayici.html">
    <meta property="og:title" content="Eksik Kira Hesaplayıcısı 2025 - Ücretsiz Kira Hesaplama Aracı">
    <meta property="og:description" content="Kiracınızdan ne kadar eksik kira alabilirsiniz? TÜFE ve ÜFE verilerine göre ücretsiz eksik kira hesaplama aracı.">
    <meta property="og:image" content="https://eievdanismanligi.com/assets/images/logo.png">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:site_name" content="Ev Sahibi Danışmanlığı">
    <meta property="og:locale" content="tr_TR">
    
    <!-- Twitter Card Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="https://eievdanismanligi.com/pages/eksik-kira-hesaplayici.html">
    <meta name="twitter:title" content="Eksik Kira Hesaplayıcısı 2025 - Ücretsiz Kira Hesaplama Aracı">
    <meta name="twitter:description" content="Kiracınızdan ne kadar eksik kira alabilirsiniz? TÜFE ve ÜFE verilerine göre ücretsiz eksik kira hesaplama aracı.">
    <meta name="twitter:image" content="https://eievdanismanligi.com/assets/images/logo.png">
    
    <!-- Additional Meta Tags -->
    <meta name="theme-color" content="#B8860B">
    <meta name="msapplication-TileColor" content="#B8860B">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Eksik Kira Hesaplayıcısı">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="../assets/images/favicon.ico">
    <link rel="apple-touch-icon" sizes="180x180" href="../assets/images/logo.png">
    <link rel="icon" type="image/png" sizes="32x32" href="../assets/images/logo.png">
    <link rel="icon" type="image/png" sizes="16x16" href="../assets/images/logo.png">
    
    <!-- Preconnect for Performance -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    <link rel="preload" href="../assets/images/logo.png" as="image">
    
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-ZTP30XELNP"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-ZTP30XELNP', {
            enhanced_measurement: {
                scrolls: true,
                outbound_clicks: true,
                site_search: true,
                video_engagement: true,
                file_downloads: true,
                page_changes: true
            }
        });
    </script>
    
    <!-- Google Search Console - Gerçek verification code ile değiştirilecek -->
    <!-- <meta name="google-site-verification" content="YOUR_VERIFICATION_CODE" /> -->
    
    <!-- Structured Data -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "Eksik Kira Hesaplayıcısı",
        "description": "Kiracınızdan ne kadar eksik kira alabilirsiniz? TÜFE ve ÜFE verilerine göre ücretsiz eksik kira hesaplama aracı. Yasal kira artış oranları ile eksik kira tutarını hesaplayın.",
        "url": "https://eievdanismanligi.com/pages/eksik-kira-hesaplayici.html",
        "applicationCategory": "FinanceApplication",
        "operatingSystem": "Web Browser",
        "browserRequirements": "Güncel web tarayıcısı",
        "offers": {
            "@type": "Offer",
            "price": "0",
            "priceCurrency": "TRY",
            "description": "Ücretsiz eksik kira hesaplama aracı"
        },
        "provider": {
            "@type": "LegalService",
            "name": "Ev Sahibi Danışmanlığı",
            "url": "https://eievdanismanligi.com",
            "telephone": "+905334222595",
            "address": {
                "@type": "PostalAddress",
                "addressCountry": "TR",
                "addressLocality": "İstanbul"
            }
        },
        "featureList": [
            "TÜFE bazlı eksik kira hesaplama",
            "ÜFE verilerine göre kira farkı hesaplama",
            "Çok yıllık eksik kira hesaplama",
            "Excel raporu oluşturma",
            "Yasal kira artış oranları",
            "Konut ve işyeri ayrımı",
            "Gerçek TÜİK verileri"
        ],
        "screenshot": "https://eievdanismanligi.com/assets/images/eksik-kira-hesaplayici-screenshot.png",
        "dateCreated": "2025-01-13",
        "dateModified": "2025-01-13",
        "author": {
            "@type": "Organization",
            "name": "Eyüpoğlu & Işıkgör Hukuk Bürosu",
            "url": "https://eievdanismanligi.com"
        },
        "inLanguage": "tr-TR",
        "isAccessibleForFree": true,
        "license": "https://eievdanismanligi.com/terms"
    }
    </script>

    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script async src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        /* Navbar Styles */
        .navbar {
            background: white;
            padding: 12px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
        }

        .nav-logo img {
            max-height: 130px;
            width: auto;
            max-width: 260px;
            display: block;
            margin: -15px auto 0 auto;
        }

        .nav-menu {
            display: flex;
            list-style: none;
            gap: 40px;
        }

        .nav-menu a {
            text-decoration: none;
            color: #475569;
            font-weight: 500;
            font-size: 15px;
            transition: color 0.3s ease;
        }

        .nav-menu a:hover {
            color: #0f172a;
        }

        .nav-menu a.active {
            color: #B8860B;
            font-weight: 600;
        }

        /* Mobile Menu Styles */
        .mobile-menu-btn {
            display: none;
            flex-direction: column;
            cursor: pointer;
            padding: 12px;
            border-radius: 6px;
            transition: background 0.3s ease;
            min-height: 48px;
            min-width: 48px;
            justify-content: center;
            align-items: center;
        }

        .mobile-menu-btn span {
            width: 25px;
            height: 3px;
            background: #475569;
            margin: 3px 0;
            transition: 0.3s;
            border-radius: 2px;
        }

        .mobile-menu {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .mobile-menu.active {
            display: block;
            opacity: 1;
            visibility: visible;
        }

        .mobile-menu-content {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            background: white;
            border-top: 1px solid #e2e8f0;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            transform: translateY(-100%);
            transition: transform 0.3s ease;
        }

        .mobile-menu.active .mobile-menu-content {
            transform: translateY(0);
        }

        .mobile-nav-menu {
            list-style: none;
            padding: 20px 30px;
        }

        .mobile-nav-menu li {
            margin-bottom: 15px;
        }

        .mobile-nav-menu a {
            display: block;
            text-decoration: none;
            color: #475569;
            font-weight: 500;
            font-size: 16px;
            padding: 16px 20px;
            border-radius: 8px;
            transition: all 0.3s ease;
            min-height: 48px;
            display: flex;
            align-items: center;
        }

        .mobile-nav-menu a.active {
            color: #B8860B;
            background: rgba(184, 134, 11, 0.1);
            font-weight: 600;
        }

        @media (max-width: 768px) {
            .desktop-menu {
                display: none;
            }

            .mobile-menu-btn {
                display: flex;
            }

            .navbar { padding: 6px 0; }
            .nav-logo { height: 56px; }
            .nav-logo img { height: 72px; max-height: 72px; max-width: 140px; margin: -8px auto 0 auto; }
            .nav-menu { gap: 20px; }
        }

        /* Main Container */
        .main-container {
            min-height: 100vh;
            padding: 120px 30px 80px;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        /* Page Header */
        .page-header {
            text-align: center;
            margin-bottom: 60px;
        }

        .page-badge {
            background: linear-gradient(135deg, #B8860B, #DAA520);
            color: white;
            padding: 8px 20px;
            border-radius: 25px;
            font-size: 14px;
            font-weight: 500;
            display: inline-block;
            margin-bottom: 20px;
            letter-spacing: 0.5px;
        }

        .page-title {
            font-family: 'Playfair Display', serif;
            font-size: clamp(36px, 4vw, 48px);
            font-weight: 700;
            color: #0f172a;
            margin-bottom: 15px;
            line-height: 1.2;
        }

        .page-subtitle {
            font-size: 18px;
            color: #64748b;
            max-width: 600px;
            margin: 0 auto;
        }

        /* Calculator Card */
        .calculator-card {
            background: white;
            border-radius: 24px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
            border: 1px solid #e2e8f0;
            margin-bottom: 40px;
        }

        .calculator-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .calculator-icon {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #B8860B, #DAA520);
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            font-size: 32px;
            color: white;
            box-shadow: 0 8px 25px rgba(184, 134, 11, 0.3);
        }

        .calculator-title {
            font-size: 24px;
            font-weight: 700;
            color: #0f172a;
            margin-bottom: 10px;
        }

        .calculator-desc {
            color: #64748b;
            font-size: 16px;
        }

        /* Form Styles */
        .form-section {
            margin-bottom: 40px;
        }

        .form-section h3 {
            color: #0f172a;
            margin-bottom: 25px;
            font-size: 20px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .form-section h3 i {
            color: #B8860B;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group.full-width {
            grid-column: 1 / -1;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #0f172a;
            font-size: 14px;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 16px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            font-size: 16px;
            font-family: 'Inter', sans-serif;
            min-height: 44px;
            transition: all 0.3s ease;
            background: white;
        }

        .form-group input:focus,
        .form-group select:focus {
            border-color: #B8860B;
            outline: 2px solid #B8860B;
            outline-offset: 2px;
            box-shadow: 0 0 0 3px rgba(184, 134, 11, 0.1);
        }

        .form-group select {
            cursor: pointer;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m6 8 4 4 4-4'/%3e%3c/svg%3e");
            background-position: right 12px center;
            background-repeat: no-repeat;
            background-size: 16px;
            padding-right: 40px;
            appearance: none;
        }

        .help-text {
            font-size: 12px;
            color: #64748b;
            margin-top: 4px;
        }

        /* Buttons */
        .btn {
            background: linear-gradient(135deg, #B8860B, #DAA520);
            color: white;
            padding: 18px 40px;
            border: none;
            border-radius: 12px;
            font-weight: 600;
            font-size: 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            min-height: 48px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 20px rgba(184, 134, 11, 0.3);
            text-decoration: none;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(184, 134, 11, 0.4);
        }

        .btn:focus {
            outline: 2px solid #fff;
            outline-offset: 2px;
            box-shadow: 0 0 0 4px rgba(184, 134, 11, 0.3);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #64748b, #475569);
            box-shadow: 0 4px 20px rgba(100, 116, 139, 0.3);
        }

        .btn-secondary:hover {
            box-shadow: 0 8px 30px rgba(100, 116, 139, 0.4);
        }

        .btn-group {
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        /* Year Form Styling */
        .year-form {
            background: #f8fafc;
            padding: 25px;
            border-radius: 16px;
            margin-bottom: 20px;
            border: 1px solid #e2e8f0;
        }

        .year-form h4 {
            color: #0f172a;
            margin-bottom: 20px;
            font-size: 18px;
            font-weight: 600;
        }

        /* Results Panel */
        .result-panel {
            background: white;
            border-radius: 24px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
            border: 1px solid #e2e8f0;
            display: none;
        }

        .result-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .result-icon {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #10b981, #059669);
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            font-size: 32px;
            color: white;
            box-shadow: 0 8px 25px rgba(16, 185, 129, 0.3);
        }

        .result-title {
            font-size: 24px;
            font-weight: 700;
            color: #0f172a;
            margin-bottom: 10px;
        }

        .result-desc {
            color: #64748b;
            font-size: 16px;
        }

        /* Summary Cards */
        .summary-cards {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr;
            gap: 25px;
            margin-bottom: 40px;
        }

        .summary-card {
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            border: 1px solid #e2e8f0;
        }

        .summary-card.main {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            border: none;
            box-shadow: 0 8px 25px rgba(16, 185, 129, 0.3);
        }

        .summary-card.secondary {
            background: #f8fafc;
            color: #0f172a;
        }

        .summary-card h4 {
            font-size: 14px;
            margin-bottom: 12px;
            opacity: 0.8;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .summary-card .amount {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .summary-card.main .amount {
            font-size: 28px;
        }

        .summary-card p {
            font-size: 12px;
            opacity: 0.7;
            margin: 0;
        }

        /* Results Table */
        .results-table {
            overflow-x: auto;
            border-radius: 16px;
            border: 1px solid #e2e8f0;
            margin-bottom: 30px;
        }

        .results-table table {
            width: 100%;
            border-collapse: collapse;
        }

        .results-table th,
        .results-table td {
            padding: 16px;
            text-align: left;
            border-bottom: 1px solid #f1f5f9;
        }

        .results-table th {
            background: #f8fafc;
            font-weight: 600;
            font-size: 14px;
            color: #475569;
        }

        .results-table td {
            font-size: 14px;
            color: #0f172a;
        }

        .results-table tbody tr:hover {
            background: #f8fafc;
        }

        .positive {
            color: #059669;
            font-weight: 600;
        }

        .negative {
            color: #dc2626;
            font-weight: 600;
        }

        .tfoot-total {
            background: linear-gradient(135deg, #0f172a, #1e293b);
            color: white;
            font-weight: 700;
            font-size: 16px;
        }

        .tfoot-total td {
            color: white;
        }

        /* Export Section */
        .export-section {
            display: flex;
            gap: 15px;
            justify-content: center;
            align-items: center;
            padding-top: 25px;
            border-top: 1px solid #e2e8f0;
        }

        .hidden {
            display: none !important;
        }

        /* Tablet Styles */
        @media (max-width: 1024px) {
            .main-container {
                padding: 110px 25px 70px;
            }

            .container {
                max-width: 700px;
            }

            .summary-cards {
                grid-template-columns: 1fr 1fr;
                gap: 20px;
            }

            .summary-card.main {
                grid-column: 1 / -1;
            }
        }

        /* Mobile Styles */
        @media (max-width: 768px) {
            .main-container {
                padding: 100px 15px 60px;
            }

            .calculator-card,
            .result-panel {
                padding: 20px;
                border-radius: 20px;
            }

            .page-header {
                margin-bottom: 40px;
            }

            .page-badge {
                padding: 6px 16px;
                font-size: 13px;
                margin-bottom: 15px;
            }

            .page-title {
                font-size: 28px;
                margin-bottom: 12px;
            }

            .page-subtitle {
                font-size: 16px;
            }

            .calculator-header {
                margin-bottom: 30px;
            }

            .calculator-icon {
                width: 60px;
                height: 60px;
                font-size: 24px;
                margin-bottom: 15px;
            }

            .calculator-title {
                font-size: 20px;
                margin-bottom: 8px;
            }

            .calculator-desc {
                font-size: 14px;
            }

            .form-section h3 {
                font-size: 18px;
                margin-bottom: 20px;
            }

            .form-row {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .form-group {
                margin-bottom: 20px;
            }

            .form-group input,
            .form-group select {
                padding: 14px;
                font-size: 16px; /* iOS zoom önleme */
            }

            .help-text {
                font-size: 11px;
            }

            .btn {
                padding: 16px 30px;
                font-size: 15px;
                width: 100%;
            }

            .btn-group {
                flex-direction: column;
                gap: 12px;
            }

            .year-form {
                padding: 20px;
                border-radius: 14px;
            }

            .year-form h4 {
                font-size: 16px;
                margin-bottom: 15px;
            }

            /* Results Mobile */
            .result-header {
                margin-bottom: 30px;
            }

            .result-icon {
                width: 60px;
                height: 60px;
                font-size: 24px;
                margin-bottom: 15px;
            }

            .result-title {
                font-size: 20px;
                margin-bottom: 8px;
            }

            .result-desc {
                font-size: 14px;
            }

            .summary-cards {
                grid-template-columns: 1fr;
                gap: 15px;
                margin-bottom: 30px;
            }

            .summary-card {
                padding: 20px;
                border-radius: 16px;
            }

            .summary-card h4 {
                font-size: 12px;
                margin-bottom: 8px;
            }

            .summary-card .amount {
                font-size: 20px;
            }

            .summary-card.main .amount {
                font-size: 24px;
            }

            .summary-card p {
                font-size: 11px;
            }

            /* Mobile Table */
            .results-table {
                border-radius: 12px;
                font-size: 12px;
            }

            .results-table th,
            .results-table td {
                padding: 10px 8px;
                font-size: 11px;
            }

            .results-table th {
                font-size: 10px;
            }

            .export-section {
                flex-direction: column;
                gap: 12px;
            }
        }

        /* Small Mobile Styles */
        @media (max-width: 480px) {
            .main-container {
                padding: 95px 10px 50px;
            }

            .calculator-card,
            .result-panel {
                padding: 15px;
                border-radius: 18px;
            }

            .page-title {
                font-size: 24px;
            }

            .page-subtitle {
                font-size: 14px;
            }

            .form-section h3 {
                font-size: 16px;
            }

            .year-form {
                padding: 15px;
            }

            .summary-card {
                padding: 15px;
            }

            .results-table {
                font-size: 10px;
            }

            .results-table th,
            .results-table td {
                padding: 8px 4px;
                font-size: 9px;
            }

            /* Horizontal scroll for table on very small screens */
            .results-table {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }

            .results-table table {
                min-width: 600px;
            }
        }

        /* High DPI / Retina Display Optimization */
        @media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
            .calculator-icon,
            .result-icon {
                box-shadow: 0 8px 25px rgba(184, 134, 11, 0.4);
            }
        }

        /* Landscape Mobile */
        @media screen and (max-height: 500px) and (orientation: landscape) {
            .main-container {
                padding: 80px 15px 40px;
            }

            .page-header {
                margin-bottom: 25px;
            }

            .calculator-header {
                margin-bottom: 20px;
            }
        }

        /* Touch Device Optimizations */
        @media (hover: none) and (pointer: coarse) {
            .btn {
                min-height: 48px; /* Apple HIG minimum touch target */
                padding: 16px 20px;
            }

            .form-group input,
            .form-group select {
                min-height: 48px;
                padding: 16px;
            }

            /* Better tap targets for mobile */
            .mobile-nav-menu a {
                min-height: 48px;
                padding: 16px 20px;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <a href="../index.html" style="display: block;">
                    <img src="../assets/images/logo.png" alt="Eyüpoğlu & Işıkgör Logo">
                </a>
            </div>
            
            <!-- Desktop Menu -->
            <ul class="nav-menu desktop-menu">
                <li><a href="../index.html">Ana Sayfa</a></li>
                <li><a href="calculator.html">Kira Artış Hesaplayıcı</a></li>
                <li><a href="eksik-kira-hesaplayici.html" class="active">Eksik Kira Hesaplayıcı</a></li>
                <li><a href="tracking.html">Kira Takip Sistemi</a></li>
                <li><a href="knowledge.html">Bilgi Merkezi</a></li>
                <li><a href="contact.html">İletişim</a></li>
            </ul>
            
            <!-- Mobile Menu Button -->
            <div class="mobile-menu-btn" aria-label="Menüyü aç/kapat" aria-expanded="false" role="button" tabindex="0">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
        
        <!-- Mobile Menu -->
        <div class="mobile-menu">
            <div class="mobile-menu-content">
                <ul class="mobile-nav-menu">
                    <li><a href="../index.html">Ana Sayfa</a></li>
                    <li><a href="calculator.html">Kira Artış Hesaplayıcı</a></li>
                    <li><a href="eksik-kira-hesaplayici.html" class="active">Eksik Kira Hesaplayıcı</a></li>
                    <li><a href="tracking.html">Kira Takip Sistemi</a></li>
                    <li><a href="knowledge.html">Bilgi Merkezi</a></li>
                    <li><a href="contact.html">İletişim</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="main-container">
        <div class="container">
            <!-- Page Header -->
            <div class="page-header">
                <div class="page-badge">
                    <i class="fas fa-calculator"></i> Ücretsiz Araç
                </div>
                <h1 class="page-title">Eksik Kira Hesaplayıcısı</h1>
                <p class="page-subtitle">Kiracınızdan ne kadar eksik kira alabilirsiniz? Sözleşme tarihinden itibaren yasal maksimum kira artışlarını hesaplayın.</p>
            </div>

            <!-- Calculator Card -->
            <div class="calculator-card">
                <div class="calculator-header">
                    <div class="calculator-icon">
                        <i class="fas fa-calculator"></i>
                    </div>
                    <h2 class="calculator-title">Eksik Kira Hesaplama</h2>
                    <p class="calculator-desc">Sözleşme bilgilerinizi girin ve kiracınızdan talep edebileceğiniz eksik kira miktarını öğrenin.</p>
                </div>

                <!-- Temel Bilgiler -->
                <div class="form-section">
                    <h3><i class="fas fa-file-contract"></i> Sözleşme Bilgileri</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="contractDate">Sözleşme Başlangıç Tarihi</label>
                            <input type="date" id="contractDate" required 
                                   aria-label="Kira sözleşmesinin başlangıç tarihini seçin"
                                   aria-describedby="contractDateHelp">
                            <div class="help-text" id="contractDateHelp">Kira sözleşmenizin başladığı tarihi seçin</div>
                        </div>
                        <div class="form-group">
                            <label for="initialRent">Başlangıç Aylık Kira (₺)</label>
                            <input type="number" id="initialRent" step="0.01" required placeholder="5.000"
                                   aria-label="Sözleşmede belirlenen başlangıç kira miktarını girin"
                                   aria-describedby="initialRentHelp">
                            <div class="help-text" id="initialRentHelp">Sözleşmede belirlenen ilk kira tutarı</div>
                        </div>
                    </div>
                    <div class="form-group full-width">
                        <label for="propertyType">Gayrimenkul Türü</label>
                        <select id="propertyType" required 
                                aria-label="Kiraladığınız gayrimenkulün türünü seçin"
                                aria-describedby="propertyTypeHelp">
                            <option value="">Gayrimenkul türünü seçin</option>
                            <option value="konut">Konut (Mesken)</option>
                            <option value="isyeri">İşyeri (Ticari)</option>
                            <option value="other">Diğer</option>
                        </select>
                        <div class="help-text" id="propertyTypeHelp">Konut için özel yasal sınırlar geçerli olabilir</div>
                    </div>
                    
                    <button type="button" class="btn" onclick="nextStep()" 
                            aria-label="Ödeme bilgileri adımına geç">
                        <i class="fas fa-arrow-right"></i> Devam Et
                    </button>
                </div>

                <!-- Yıllık Ödeme Bilgileri -->
                <div id="paymentSection" class="form-section hidden">
                    <h3><i class="fas fa-money-bill-wave"></i> Kiracının Ödeme Bilgileri</h3>
                    <div id="yearlyPayments">
                        <!-- Dinamik olarak yıllık formlar buraya gelecek -->
                    </div>
                    <div class="btn-group">
                        <button type="button" class="btn btn-secondary" onclick="prevStep()">
                            <i class="fas fa-arrow-left"></i> Geri
                        </button>
                        <button type="button" class="btn" onclick="calculateMissingRent()">
                            <i class="fas fa-calculator"></i> Hesapla
                        </button>
                    </div>
                </div>
            </div>

            <!-- Sonuçlar -->
            <div class="result-panel" id="results">
                <div class="result-header">
                    <div class="result-icon">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <h2 class="result-title">Hesaplama Sonuçları</h2>
                    <p class="result-desc">Kiracınızdan talep edebileceğiniz eksik kira miktarı</p>
                </div>
                
                <div class="summary-cards">
                    <div class="summary-card main">
                        <h4>Toplam Eksik Kira</h4>
                        <div class="amount" id="totalMissing">₺0</div>
                        <p>Kiracınızdan talep edebileceğiniz tutar</p>
                    </div>
                    <div class="summary-card secondary">
                        <h4>Olması Gereken Toplam</h4>
                        <div class="amount" id="totalExpected">₺0</div>
                    </div>
                    <div class="summary-card secondary">
                        <h4>Ödenen Toplam</h4>
                        <div class="amount" id="totalPaid">₺0</div>
                    </div>
                </div>

                <div class="results-table">
                    <table>
                        <thead>
                            <tr>
                                <th>Yıl</th>
                                <th>Sözl. Oran</th>
                                <th>Maks. Yasal</th>
                                <th>Beklenen</th>
                                <th>Ödenen</th>
                                <th>Aylık Fark</th>
                                <th>Yıllık Fark</th>
                            </tr>
                        </thead>
                        <tbody id="resultsBody">
                            <!-- Dinamik sonuçlar -->
                        </tbody>
                        <tfoot>
                            <tr class="tfoot-total">
                                <td colspan="6">TOPLAM EKSİK KİRA:</td>
                                <td id="footerTotal" class="positive">₺0</td>
                            </tr>
                        </tfoot>
                    </table>
                </div>

                <div class="export-section">
                    <button type="button" class="btn" onclick="exportResults()">
                        <i class="fas fa-download"></i> Excel Raporu İndir
                    </button>
                    <button type="button" class="btn btn-secondary" onclick="resetCalculator()">
                        <i class="fas fa-refresh"></i> Yeni Hesaplama
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // TÜFE rates from TÜİK - CORRECT DATA
        const tufeRates = {
            '2011': { '01': 6.47, '02': 9.37, '03': 9.24, '04': 6.00, '05': 5.93, '06': 9.13, '07': 9.47 }, // Eksik aylar var - tamamlanacak
            '2012': { '01': 6.95, '02': 7.48, '03': 8.02, '04': 8.59, '05': 8.68, '06': 8.89, '07': 9.11, '08': 9.29, '09': 9.53, '10': 9.53, '11': 9.26, '12': 8.89 },
            '2013': { '01': 8.62, '02': 8.33, '03': 8.08, '04': 7.66, '05': 7.51, '06': 7.47, '07': 7.47, '08': 7.42, '09': 7.32, '10': 7.32, '11': 7.39, '12': 7.49 },
            '2014': { '01': 7.53, '02': 7.60, '03': 7.70, '04': 7.97, '05': 8.23, '06': 8.31, '07': 8.35, '08': 8.46, '09': 8.54, '10': 8.65, '11': 8.80, '12': 8.85 },
            '2015': { '01': 8.80, '02': 8.77, '03': 8.70, '04': 8.57, '05': 8.45, '06': 8.28, '07': 8.07, '08': 7.88, '09': 7.80, '10': 7.69, '11': 7.61, '12': 7.67 },
            '2016': { '01': 7.87, '02': 7.97, '03': 7.96, '04': 7.84, '05': 7.71, '06': 7.74, '07': 7.91, '08': 7.98, '09': 7.92, '10': 7.89, '11': 7.79, '12': 7.78 },
            '2017': { '01': 7.76, '02': 7.88, '03': 8.21, '04': 8.66, '05': 9.09, '06': 9.36, '07': 9.44, '08': 9.66, '09': 9.98, '10': 10.37, '11': 10.87, '12': 11.14 },
            '2018': { '01': 11.23, '02': 11.23, '03': 11.14, '04': 11.06, '05': 11.10, '06': 11.49, '07': 12.00, '08': 12.61, '09': 13.75, '10': 14.90, '11': 15.63, '12': 16.33 },
            '2019': { '01': 17.16, '02': 17.93, '03': 18.70, '04': 19.39, '05': 19.91, '06': 19.88, '07': 19.91, '08': 19.62, '09': 18.27, '10': 16.81, '11': 15.87, '12': 15.18 },
            '2020': { '01': 14.52, '02': 13.94, '03': 13.33, '04': 12.66, '05': 12.10, '06': 11.88, '07': 11.51, '08': 11.27, '09': 11.47, '10': 11.74, '11': 12.04, '12': 12.28 },
            '2021': { '01': 12.53, '02': 12.81, '03': 13.18, '04': 13.70, '05': 14.13, '06': 14.55, '07': 15.15, '08': 15.78, '09': 16.42, '10': 17.09, '11': 17.71, '12': 19.60 },
            '2022': { '01': 22.58, '02': 25.98, '03': 29.88, '04': 34.46, '05': 39.33, '06': 44.54, '07': 49.65, '08': 54.69, '09': 59.91, '10': 65.26, '11': 70.36, '12': 72.31 },
            '2023': { '01': 72.45, '02': 71.83, '03': 70.20, '04': 67.20, '05': 63.72, '06': 59.95, '07': 57.45, '08': 56.28, '09': 55.30, '10': 54.26, '11': 53.40, '12': 53.86 },
            '2024': { '01': 54.72, '02': 55.91, '03': 57.50, '04': 59.64, '05': 62.51, '06': 65.07, '07': 65.93, '08': 64.91, '09': 63.47, '10': 62.02, '11': 60.45, '12': 58.51 },
            '2025': { '01': 56.35, '02': 53.83, '03': 51.26, '04': 48.73, '05': 45.80, '06': 43.23, '07': 41.13 }
        };

        // ÜFE rates from TÜİK - CORRECT DATA
        const ufeRates = {
            '2011': { '01': 6.69, '02': 9.23, '03': 9.36, '04': 9.17, '05': 9.21, '06': 9.42, '07': 9.59, '08': 9.16, '09': 10.03, '10': 10.28, '11': 10.72, '12': 11.09 },
            '2012': { '01': 11.11, '02': 10.96, '03': 10.79, '04': 10.72, '05': 10.57, '06': 10.24, '07': 9.88, '08': 9.33, '09': 8.65, '10': 7.80, '11': 6.98, '12': 6.09 },
            '2013': { '01': 5.33, '02': 4.72, '03': 4.23, '04': 3.74, '05': 3.27, '06': 3.18, '07': 3.23, '08': 3.39, '09': 3.58, '10': 3.93, '11': 4.1, '12': 4.48 },
            '2014': { '01': 5.22, '02': 6.11, '03': 6.95, '04': 7.89, '05': 8.66, '06': 9.03, '07': 9.26, '08': 9.55, '09': 9.84, '10': 10.11, '11': 10.32, '12': 10.25 },
            '2015': { '01': 9.59, '02': 8.79, '03': 8.03, '04': 7.36, '05': 6.98, '06': 6.74, '07': 6.43, '08': 6.14, '09': 5.92, '10': 5.58, '11': 5.33, '12': 5.28 },
            '2016': { '01': 5.50, '02': 5.61, '03': 5.84, '04': 5.47, '05': 5.19, '06': 4.91, '07': 4.77, '08': 4.51, '09': 4.07, '10': 3.83, '11': 3.93, '12': 4.30 },
            '2017': { '01': 4.96, '02': 5.87, '03': 6.89, '04': 8.01, '05': 9.02, '06': 9.98, '07': 10.94, '08': 12.05, '09': 13.26, '10': 14.47, '11': 15.38, '12': 15.82 },
            '2018': { '01': 15.66, '02': 15.50, '03': 15.35, '04': 15.36, '05': 15.80, '06': 16.57, '07': 17.41, '08': 18.78, '09': 21.36, '10': 23.73, '11': 25.52, '12': 27.01 },
            '2019': { '01': 28.70, '02': 29.97, '03': 31.17, '04': 32.24, '05': 32.85, '06': 32.81, '07': 32.34, '08': 30.51, '09': 26.44, '10': 22.58, '11': 19.68, '12': 17.56 },
            '2020': { '01': 15.71, '02': 14.18, '03': 12.61, '04': 10.87, '05': 9.14, '06': 7.74, '07': 6.81, '08': 6.71, '09': 7.71, '10': 9.11, '11': 10.69, '12': 12.18 },
            '2021': { '01': 13.64, '02': 15.14, '03': 17.04, '04': 19.44, '05': 22.24, '06': 25.38, '07': 28.47, '08': 31.34, '09': 33.83, '10': 36.20, '11': 38.94, '12': 43.86 },
            '2022': { '01': 49.93, '02': 56.83, '03': 64.30, '04': 72.03, '05': 80.38, '06': 88.77, '07': 97.30, '08': 105.39, '09': 114.02, '10': 122.93, '11': 128.94, '12': 128.47 },
            '2023': { '01': 125.53, '02': 120.72, '03': 113.73, '04': 105.50, '05': 95.80, '06': 86.59, '07': 78.51, '08': 71.97, '09': 65.55, '10': 58.46, '11': 53.15, '12': 49.93 },
            '2024': { '01': 47.35, '02': 45.71, '03': 45.28, '04': 45.83, '05': 47.24, '06': 47.97, '07': 47.55, '08': 46.23, '09': 44.81, '10': 43.93, '11': 42.60, '12': 41.10 },
            '2025': { '01': 39.50, '02': 37.55, '03': 35.23, '04': 32.65, '05': 30.17, '06': 28.34, '07': 27.07 }
        };

        // Yİ-ÜFE rates from main calculator - EXACT MATCH
        const yiufeRates = {
            '2019': { '01': 28.15, '02': 25.95, '03': 24.52, '04': 22.89, '05': 20.35, '06': 16.47, '07': 12.58, '08': 8.95, '09': 5.23, '10': 2.47, '11': 1.85, '12': 7.36 },
            '2020': { '01': 12.94, '02': 16.67, '03': 15.04, '04': 4.13, '05': -7.67, '06': -12.78, '07': -10.43, '08': -6.95, '09': -3.15, '10': 0.27, '11': 4.08, '12': 25.15 },
            '2021': { '01': 26.16, '02': 31.20, '03': 39.27, '04': 68.50, '05': 89.05, '06': 116.73, '07': 138.34, '08': 145.09, '09': 151.37, '10': 158.54, '11': 210.64, '12': 79.89 },
            '2022': { '01': 105.01, '02': 108.53, '03': 115.90, '04': 121.82, '05': 132.16, '06': 138.34, '07': 138.76, '08': 145.68, '09': 151.64, '10': 158.35, '11': 167.05, '12': 54.62 },
            '2023': { '01': 86.46, '02': 76.61, '03': 62.45, '04': 52.11, '05': 40.76, '06': 40.42, '07': 44.50, '08': 49.41, '09': 47.44, '10': 39.39, '11': 42.25, '12': 44.22 },
            '2024': { '01': 44.20, '02': 47.29, '03': 51.47, '04': 55.66, '05': 57.68, '06': 50.09, '07': 41.37, '08': 35.75, '09': 33.09, '10': 32.24, '11': 29.47, '12': 28.52 },
            '2025': { '01': 27.20, '02': 25.21, '03': 23.50, '04': 22.50, '05': 23.13, '07': 24.19 }
        };

        // Ana hesaplayıcıdaki fixed averages (yasal oranlar)
        const legalRatesByYear = {
            // 2012-2018: ÜFE fixed averages
            2012: 6.09,   // 2011 ÜFE average for 2012
            2013: 4.52,   // 2012 ÜFE average for 2013
            2014: 10.25,  // 2013 ÜFE average for 2014
            2015: 5.28,   // 2014 ÜFE average for 2015
            2016: 4.33,   // 2015 ÜFE average for 2016
            2017: 15.76,  // 2016 ÜFE average for 2017
            2018: 27.01,  // 2017 ÜFE average for 2018
            // 2019-2022: TÜFE fixed averages
            2019: 15.18,  // 2018 TÜFE average for 2019
            2020: 12.28,  // 2019 TÜFE average for 2020
            2021: 19.60,  // 2020 TÜFE average for 2021
            2022: 72.31,  // 2021 TÜFE average for 2022
            // 2023: Calculated TÜFE (will be calculated)
            // 2024-2025: TÜFE fixed averages
            2024: 62.45,  // 2023 TÜFE average for 2024
            2025: 36.70   // 2024 TÜFE average for 2025
        };

        let calculationData = [];
        
        // Chart için gerekli değişkenler (hata düzeltmesi)
        const years = Object.keys(tufeRates).map(year => parseInt(year)).sort();
        

        function getRateOptions(year, contractDate, propertyType) {
            const prevYear = year - 1;
            const contractMonth = String(contractDate.getMonth() + 1).padStart(2, '0');
            let options = '';

            // Ana hesaplayıcıdaki tam mantık - yasal oran belirleme
            let legalRateText = 'TÜFE (Yasal oran)';
            let legalRate = 0;
            
            // Ana hesaplayıcıdaki updateRatePreferenceOptions mantığı
            const yearNum = parseInt(year);
            if (yearNum >= 2012 && yearNum <= 2018) {
                // 2012-2018 Period: Use previous month's ÜFE rate for legal rate
                const contractMonthNum = contractDate.getMonth() + 1;
                let prevMonthForRate, prevYearForRate;
                if (contractMonthNum === 1) {
                    prevMonthForRate = 12;
                    prevYearForRate = year - 1;
                } else {
                    prevMonthForRate = contractMonthNum - 1;
                    prevYearForRate = year;
                }
                const prevMonthStr = String(prevMonthForRate).padStart(2, '0');
                
                if (ufeRates[prevYearForRate] && ufeRates[prevYearForRate][prevMonthStr]) {
                    legalRate = ufeRates[prevYearForRate][prevMonthStr];
                    legalRateText = `%${legalRate.toFixed(2)} (ÜFE 12 Aylık Ortalama - Yasal)`;
                }
                
                // Generate options and return immediately for 2012-2018 period
                let options = '';
                
                // 1. Yasal Oran: ÜFE 12 Aylık Ortalama - seçili
                if (ufeRates[prevYearForRate] && ufeRates[prevYearForRate][prevMonthStr]) {
                    const ufeRate = ufeRates[prevYearForRate][prevMonthStr];
                    options += `<option value="${ufeRate}|ÜFE 12 Aylık Ortalama - Yasal" selected>ÜFE 12 Aylık Ortalama - Yasal - %${ufeRate.toFixed(2)}</option>`;
                }
                
                // 2. TÜFE 12 Aylık Ortalama
                if (tufeRates[prevYearForRate] && tufeRates[prevYearForRate][prevMonthStr]) {
                    const tufeRate = tufeRates[prevYearForRate][prevMonthStr];
                    options += `<option value="${tufeRate}|TÜFE 12 Aylık Ortalama">TÜFE 12 Aylık Ortalama - %${tufeRate.toFixed(2)}</option>`;
                }
                
                // 3. Özel Oran
                options += '<option value="custom|Özel Oran">Özel Oran</option>';
                
                return options;
            } else if ((yearNum >= 2019 && yearNum < 2022) || 
                      (yearNum === 2022 && new Date(year, contractDate.getMonth(), contractDate.getDate()) < new Date('2022-06-11'))) {
                // 2019-11 Haziran 2022: TÜFE yasal, ÜFE alternatif
                const contractMonthNum = contractDate.getMonth() + 1;
                let prevMonthForRate, prevYearForRate;
                if (contractMonthNum === 1) {
                    prevMonthForRate = 12;
                    prevYearForRate = year - 1;
                } else {
                    prevMonthForRate = contractMonthNum - 1;
                    prevYearForRate = year;
                }
                const prevMonthStr = String(prevMonthForRate).padStart(2, '0');
                
                // 1. Yasal Oran: TÜFE 12 Aylık Ortalama - seçili
                if (tufeRates[prevYearForRate] && tufeRates[prevYearForRate][prevMonthStr]) {
                    const tufeRate = tufeRates[prevYearForRate][prevMonthStr];
                    legalRate = tufeRate;
                    legalRateText = `%${tufeRate.toFixed(2)} (TÜFE 12 Aylık Ortalama - Yasal)`;
                    options = `<option value="${tufeRate}|TÜFE 12 Aylık Ortalama - Yasal" selected>Yasal Oran: %${tufeRate.toFixed(2)} (TÜFE 12 Aylık Ortalama - Yasal)</option>`;
                }
                
                // 2. ÜFE 12 Aylık Ortalama
                if (ufeRates[prevYearForRate] && ufeRates[prevYearForRate][prevMonthStr]) {
                    const ufeRate = ufeRates[prevYearForRate][prevMonthStr];
                    options += `<option value="${ufeRate}|ÜFE 12 Aylık Ortalama">ÜFE 12 Aylık Ortalama - %${ufeRate.toFixed(2)}</option>`;
                }
                
                // 3. Özel Oran
                options += '<option value="custom|Özel Oran">Özel Oran</option>';
                return options;
            } else if ((yearNum === 2022 && new Date(year, contractDate.getMonth(), contractDate.getDate()) >= new Date('2022-06-11')) || 
                      (yearNum === 2023) || 
                      (yearNum === 2024 && new Date(year, contractDate.getMonth(), contractDate.getDate()) < new Date('2024-07-01'))) {
                // 11 Haziran 2022 - 1 Temmuz 2024: %25 yasal sınır
                let optionsArray = [];
                
                // 1. Yasal Oran: %25 sınır - seçili
                legalRate = 25;
                legalRateText = '%25 (Yasal Sınır)';
                optionsArray.push({
                    value: '25|Yasal Sınır',
                    text: 'Yasal Oran: %25 (Yasal Sınır)',
                    selected: true
                });
                
                // 2. TÜFE 12 Aylık Ortalama
                const contractMonthNum = contractDate.getMonth() + 1;
                let prevMonthForRate = contractMonthNum === 1 ? 12 : contractMonthNum - 1;
                let prevYearForRate = contractMonthNum === 1 ? year - 1 : year;
                const prevMonthStr = String(prevMonthForRate).padStart(2, '0');
                
                if (tufeRates[prevYearForRate] && tufeRates[prevYearForRate][prevMonthStr]) {
                    const tufeRate = tufeRates[prevYearForRate][prevMonthStr];
                    optionsArray.push({
                        value: `${tufeRate}|TÜFE 12 Aylık Ortalama`,
                        text: `TÜFE 12 Aylık Ortalama - %${tufeRate.toFixed(2)}`,
                        selected: false
                    });
                }
                
                // 3. ÜFE 12 Aylık Ortalama
                if (ufeRates[prevYearForRate] && ufeRates[prevYearForRate][prevMonthStr]) {
                    const ufeRate = ufeRates[prevYearForRate][prevMonthStr];
                    optionsArray.push({
                        value: `${ufeRate}|ÜFE 12 Aylık Ortalama`,
                        text: `ÜFE 12 Aylık Ortalama - %${ufeRate.toFixed(2)}`,
                        selected: false
                    });
                }
                
                // 4. Özel Oran
                optionsArray.push({
                    value: 'custom|Özel Oran',
                    text: 'Özel Oran',
                    selected: false
                });
                
                // Seçenekleri HTML'e dönüştür
                options = optionsArray.map(opt => 
                    `<option value="${opt.value}"${opt.selected ? ' selected' : ''}>${opt.text}</option>`
                ).join('');
                return options;
            } else if (yearNum === 2023) {
                // 2023: Full year 25% limit for housing
                const baseRate = calculateYearlyAverage(tufeRates, '2022');
                if (propertyType === 'konut') {
                    legalRate = Math.min(baseRate, 25);
                    legalRateText = `%${legalRate.toFixed(2)} (Yasal Sınır - 2022-2024)`;
                } else {
                    legalRate = baseRate;
                    legalRateText = `%${legalRate.toFixed(2)} (TÜFE - 12 aylık ortalama)`;
                }
            } else if (yearNum === 2024) {
                // 2024: 25% limit until July 1, then back to TÜFE
                const baseRate = legalRatesByYear[yearNum] || 0;
                const increaseDate = new Date(contractDate);
                increaseDate.setFullYear(year);
                const limitEndDate = new Date('2024-07-01');
                
                if (propertyType === 'konut' && increaseDate < limitEndDate) {
                    legalRate = Math.min(baseRate, 25);
                    legalRateText = `%${legalRate.toFixed(2)} (Yasal Sınır - 2022-2024)`;
                } else {
                    legalRate = baseRate;
                    legalRateText = `%${legalRate.toFixed(2)} (TÜFE - 12 aylık ortalama)`;
                }
            } else if ((yearNum === 2024 && new Date(year, contractDate.getMonth(), contractDate.getDate()) >= new Date('2024-07-01')) || yearNum >= 2025) {
                // 2 Temmuz 2024+: TÜFE 12 aylık ortalama yasal sınır
                const contractMonthNum = contractDate.getMonth() + 1;
                let prevMonthForRate = contractMonthNum === 1 ? 12 : contractMonthNum - 1;
                let prevYearForRate = contractMonthNum === 1 ? year - 1 : year;
                const prevMonthStr = String(prevMonthForRate).padStart(2, '0');
                
                // 1. TÜFE 12 Aylık Ortalama - Yasal
                if (tufeRates[prevYearForRate] && tufeRates[prevYearForRate][prevMonthStr]) {
                    const tufeRate = tufeRates[prevYearForRate][prevMonthStr];
                    legalRate = tufeRate;
                    legalRateText = `%${tufeRate.toFixed(2)} (TÜFE 12 Aylık Ortalama - Yasal)`;
                    options = `<option value="${tufeRate}|TÜFE 12 Aylık Ortalama - Yasal" selected>Yasal Oran: %${tufeRate.toFixed(2)} (TÜFE 12 Aylık Ortalama - Yasal)</option>`;
                }
                
                // 2. ÜFE 12 Aylık Ortalama
                if (ufeRates[prevYearForRate] && ufeRates[prevYearForRate][prevMonthStr]) {
                    const ufeRate = ufeRates[prevYearForRate][prevMonthStr];
                    options += `<option value="${ufeRate}|ÜFE 12 Aylık Ortalama">ÜFE 12 Aylık Ortalama - %${ufeRate.toFixed(2)}</option>`;
                }
                
                // 3. Özel Oran
                options += '<option value="custom|Özel Oran">Özel Oran</option>';
                return options;
            } else {
                // Fallback for years not covered above
                legalRate = 0;
                legalRateText = 'Bilinmeyen dönem';
                return '<option value="custom|Özel Oran">Özel Oran</option>';
            }

            // Ana hesaplayıcıdaki dönemlere göre seçenekleri filtrele  
            if ((yearNum === 2022 && new Date(year, contractDate.getMonth(), contractDate.getDate()) >= new Date('2022-06-11')) || 
                      (yearNum === 2023) || 
                      (yearNum === 2024 && new Date(year, contractDate.getMonth(), contractDate.getDate()) < new Date('2024-07-01'))) {
                // 11 Haziran 2022 - 1 Temmuz 2024 Period (%25 limit period)
                
                // Yasal oran seçeneği
                if (legalRateText && legalRate > 0) {
                    options += `<option value="${legalRate}|${legalRateText}" selected>${legalRateText} - %${legalRate.toFixed(2)}</option>`;
                }
                
                // ÜFE (bir önceki ay)
                const contractMonthNum = contractDate.getMonth() + 1;
                let prevMonthForTufe, prevYearForTufe;
                if (contractMonthNum === 1) {
                    prevMonthForTufe = 12;
                    prevYearForTufe = year - 1;
                } else {
                    prevMonthForTufe = contractMonthNum - 1;
                    prevYearForTufe = year;
                }
                const prevMonthStr = String(prevMonthForTufe).padStart(2, '0');
                if (ufeRates[prevYearForTufe] && ufeRates[prevYearForTufe][prevMonthStr]) {
                    const rate = ufeRates[prevYearForTufe][prevMonthStr];
                    options += `<option value="${rate}|ÜFE (bir önceki ay)">ÜFE (bir önceki ay) - %${rate.toFixed(2)}</option>`;
                }
                
                // TÜFE (bir önceki ay)
                if (tufeRates[prevYearForTufe] && tufeRates[prevYearForTufe][prevMonthStr]) {
                    const rate = tufeRates[prevYearForTufe][prevMonthStr];
                    options += `<option value="${rate}|TÜFE (bir önceki ay)">TÜFE (bir önceki ay) - %${rate.toFixed(2)}</option>`;
                }
                
                // TÜFE (12 aylık ortalama)
                const tufeAvg = calculateYearlyAverage(tufeRates, prevYear);
                if (tufeAvg > 0) {
                    options += `<option value="${tufeAvg}|TÜFE (12 aylık ortalama)">TÜFE (12 aylık ortalama) - %${tufeAvg.toFixed(2)}</option>`;
                }
                
                // Özel Oran
                options += '<option value="custom|Özel Oran">Özel Oran</option>';
                
            } else if (yearNum >= 2025) {
                // 2025+ Period: Same as 2019-2021 options
                
                // Yasal oran seçeneği (2025 için 36.70)
                if (legalRateText && legalRate > 0) {
                    options += `<option value="${legalRate}|${legalRateText}" selected>${legalRateText} - %${legalRate.toFixed(2)}</option>`;
                }
                
                // TÜFE (bir önceki ay)
                const contractMonthNum = contractDate.getMonth() + 1;
                let prevMonthForTufe, prevYearForTufe;
                if (contractMonthNum === 1) {
                    prevMonthForTufe = 12;
                    prevYearForTufe = year - 1;
                } else {
                    prevMonthForTufe = contractMonthNum - 1;
                    prevYearForTufe = year;
                }
                const prevMonthStr = String(prevMonthForTufe).padStart(2, '0');
                if (tufeRates[prevYearForTufe] && tufeRates[prevYearForTufe][prevMonthStr]) {
                    const rate = tufeRates[prevYearForTufe][prevMonthStr];
                    options += `<option value="${rate}|TÜFE (bir önceki ay)">TÜFE (bir önceki ay) - %${rate.toFixed(2)}</option>`;
                }
                
                // ÜFE (bir önceki ay)
                if (ufeRates[prevYearForTufe] && ufeRates[prevYearForTufe][prevMonthStr]) {
                    const rate = ufeRates[prevYearForTufe][prevMonthStr];
                    options += `<option value="${rate}|ÜFE (bir önceki ay)">ÜFE (bir önceki ay) - %${rate.toFixed(2)}</option>`;
                }
                
                // Yİ-ÜFE (12 aylık ortalama)
                if (yiufeRates[prevYear] && yiufeRates[prevYear][contractMonth]) {
                    const rate = yiufeRates[prevYear][contractMonth];
                    options += `<option value="${rate}|Yİ-ÜFE (12 aylık ortalama)">Yİ-ÜFE (12 aylık ortalama) - %${rate.toFixed(2)}</option>`;
                }
                
                // Özel Oran
                options += '<option value="custom|Özel Oran">Özel Oran</option>';
                
            } else {
                // Other periods: Show all options (fallback)
                if (legalRateText && legalRate > 0) {
                    options += `<option value="${legalRate}|${legalRateText}" selected>Yasal Oran: ${legalRateText} - %${legalRate.toFixed(2)}</option>`;
                }
                options += '<option value="custom|Özel Oran">Özel Oran</option>';
            }

            return options;
        }

        function nextStep() {
            const contractDateEl = document.getElementById('contractDate');
            const initialRentEl = document.getElementById('initialRent');
            const propertyTypeEl = document.getElementById('propertyType');
            
            if (!contractDateEl || !initialRentEl || !propertyTypeEl) {
                alert('Form elemanları bulunamadı!');
                return;
            }
            
            const contractDate = contractDateEl.value;
            const initialRent = parseFloat(initialRentEl.value);
            const propertyType = propertyTypeEl.value;

            if (!contractDate || !initialRent || !propertyType) {
                alert('Lütfen tüm alanları doldurun!');
                return;
            }
            
            // Tarih validasyonu
            const contractDateObj = new Date(contractDate);
            const currentDate = new Date();
            if (contractDateObj >= currentDate) {
                alert('Sözleşme tarihi bugünden önceki bir tarih olmalıdır!');
                return;
            }
            
            // Kira miktarı validasyonu
            if (initialRent <= 0 || initialRent > 1000000) {
                alert('Lütfen geçerli bir kira miktarı giriniz! (0-1,000,000 TL arası)');
                return;
            }

            generateYearlyForms(new Date(contractDate), initialRent, propertyType);
            const paymentSection = document.getElementById('paymentSection');
            if (paymentSection) {
                paymentSection.classList.remove('hidden');
            }
        }

        function prevStep() {
            const paymentSection = document.getElementById('paymentSection');
            if (paymentSection) {
                paymentSection.classList.add('hidden');
            }
        }

        function generateYearlyForms(contractDate, initialRent, propertyType) {
            const container = document.getElementById('yearlyPayments');
            if (!container) {
                console.error('yearlyPayments container bulunamadı!');
                return;
            }
            container.innerHTML = '';

            const currentYear = new Date().getFullYear();
            const startYear = contractDate.getFullYear();

            for (let year = startYear; year <= currentYear; year++) {
                if (year === startYear) continue; // İlk yıl artış olmaz

                const yearDiv = document.createElement('div');
                yearDiv.className = 'year-form';
                
                const rateOptions = getRateOptions(year, contractDate, propertyType);

                // Seçenekleri temizle ve yeniden oluştur
                const rateSelect = document.createElement('select');
                rateSelect.id = `rateSelect_${year}`;
                rateSelect.className = 'rate-select';
                rateSelect.setAttribute('onchange', `handleRateSelection(${year})`);
                
                // Seçenekleri ayrı ayrı ekle
                const options = rateOptions.split('</option>');
                const uniqueOptions = new Set(); // Tekrar eden seçenekleri önlemek için
                const cleanOptions = [];
                let foundOptions = {
                    yasal: false,
                    tufe: false,
                    ufe: false,
                    ozel: false
                };
                
                options.forEach(opt => {
                    if (opt.trim()) {
                        const cleanOpt = opt.trim() + '</option>';
                        // Seçeneğin türünü belirle
                        if (cleanOpt.includes('Yasal') && !foundOptions.yasal) {
                            foundOptions.yasal = true;
                            cleanOptions.push(cleanOpt);
                        } else if (cleanOpt.includes('TÜFE 12 Aylık Ortalama') && !foundOptions.tufe) {
                            foundOptions.tufe = true;
                            cleanOptions.push(cleanOpt);
                        } else if (cleanOpt.includes('ÜFE 12 Aylık Ortalama') && !foundOptions.ufe) {
                            foundOptions.ufe = true;
                            cleanOptions.push(cleanOpt);
                        } else if (cleanOpt.includes('Özel Oran') && !foundOptions.ozel) {
                            foundOptions.ozel = true;
                            cleanOptions.push(cleanOpt);
                        }
                    }
                });
                
                rateSelect.innerHTML = cleanOptions.join('');
                
                yearDiv.innerHTML = `
                    <h4>${year} Yılı Kira Bilgileri</h4>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Kiracının Bu Yıl Ödediği Aylık Kira (₺)</label>
                            <input type="number" id="paid_${year}" step="0.01" required placeholder="0">
                            <div class="help-text">Kiracının ${year} yılında ödediği aylık kira tutarı</div>
                        </div>
                        <div class="form-group">
                            <label>Sözleşmenizde Yazılan Artış Oranı</label>
                            ${rateSelect.outerHTML}
                            <div class="help-text">Sözleşmede belirlenen kira artış oranı türü</div>
                            <div id="customRateDiv_${year}" style="display: none; margin-top: 15px;">
                                <input type="number" id="customRate_${year}" step="0.01" min="0" max="100" placeholder="Özel oran girin (%)" required>
                                <div class="help-text">Sözleşmede belirtilen özel artış oranını girin</div>
                            </div>
                            <div id="rateDiv_${year}" style="display: none; margin-top: 15px;">
                                <input type="number" id="rate_${year}" step="0.01" min="0" max="100" required readonly>
                            </div>
                        </div>
                    </div>
                `;
                
                container.appendChild(yearDiv);
            }
        }

        function handleRateSelection(year) {
            const select = document.getElementById(`rateSelect_${year}`);
            const customDiv = document.getElementById(`customRateDiv_${year}`);
            const rateDiv = document.getElementById(`rateDiv_${year}`);
            const rateInput = document.getElementById(`rate_${year}`);
            
            if (!select || !customDiv || !rateDiv || !rateInput) {
                console.error('Rate selection elemanları bulunamadı!');
                return;
            }
            
            if (select.value.startsWith('custom')) {
                customDiv.style.display = 'block';
                rateDiv.style.display = 'none';
            } else if (select.value !== '') {
                customDiv.style.display = 'none';
                rateDiv.style.display = 'block';
                const rateParts = select.value.split('|');
                const rateValue = parseFloat(rateParts[0]);
                rateInput.value = rateValue.toFixed(2);
            } else {
                customDiv.style.display = 'none';
                rateDiv.style.display = 'none';
            }
        }

        function calculateMissingRent() {
            const contractDate = new Date(document.getElementById('contractDate').value);
            const initialRent = parseFloat(document.getElementById('initialRent').value);
            const propertyType = document.getElementById('propertyType').value;

            calculationData = [];
            let totalMissing = 0;
            let totalExpected = 0;
            let totalPaid = 0;
            let baseRent = initialRent;

            const currentYear = new Date().getFullYear();
            const startYear = contractDate.getFullYear();

            for (let year = startYear; year <= currentYear; year++) {
                if (year === startYear) continue;

                const paidAmount = parseFloat(document.getElementById(`paid_${year}`).value) || 0;
                
                // Oran alma - dropdown seçimine göre
                let contractRate = 0;
                let selectedRateType = '';
                const select = document.getElementById(`rateSelect_${year}`);
                
                if (select.value.startsWith('custom')) {
                    contractRate = parseFloat(document.getElementById(`customRate_${year}`).value) || 0;
                    selectedRateType = 'Özel Oran';
                } else if (select.value !== '') {
                    const rateParts = select.value.split('|');
                    contractRate = parseFloat(rateParts[0]) || 0;
                    selectedRateType = rateParts[1] || 'Bilinmeyen';
                } else {
                    contractRate = parseFloat(document.getElementById(`rate_${year}`).value) || 0;
                    selectedRateType = 'Manuel Giriş';
                }
                
                // Ana hesaplayıcıdaki yasal oran hesaplama mantığı
                let maxLegalRate = 0;
                let rateType = '';
                
                if (year >= 2012 && year <= 2018) {
                    // 2012-2018 Period: Use previous month's ÜFE rate
                    const contractMonthNum = contractDate.getMonth() + 1;
                    let prevMonthForRate, prevYearForRate;
                    if (contractMonthNum === 1) {
                        prevMonthForRate = 12;
                        prevYearForRate = year - 1;
                    } else {
                        prevMonthForRate = contractMonthNum - 1;
                        prevYearForRate = year;
                    }
                    const prevMonthStr = String(prevMonthForRate).padStart(2, '0');
                    
                    if (ufeRates[prevYearForRate] && ufeRates[prevYearForRate][prevMonthStr]) {
                        maxLegalRate = ufeRates[prevYearForRate][prevMonthStr];
                        rateType = 'ÜFE 12A ort. - Yasal';
                    }
                } else if ((year >= 2019 && year <= 2021) || (year === 2022 && new Date(year, contractDate.getMonth(), contractDate.getDate()) < new Date('2022-06-11'))) {
                    // 2019 - 10 Haziran 2022 Period: Use previous month's TÜFE rate
                    const contractMonthNum = contractDate.getMonth() + 1;
                    let prevMonthForRate, prevYearForRate;
                    if (contractMonthNum === 1) {
                        prevMonthForRate = 12;
                        prevYearForRate = year - 1;
                    } else {
                        prevMonthForRate = contractMonthNum - 1;
                        prevYearForRate = year;
                    }
                    const prevMonthStr = String(prevMonthForRate).padStart(2, '0');
                    
                    if (tufeRates[prevYearForRate] && tufeRates[prevYearForRate][prevMonthStr]) {
                        maxLegalRate = tufeRates[prevYearForRate][prevMonthStr];
                        rateType = 'TÜFE 12A ort. - Yasal';
                    }
                } else if (year === 2022 && new Date(year, contractDate.getMonth(), contractDate.getDate()) >= new Date('2022-06-11')) {
                    // 11 Haziran 2022 - 31 Aralık 2022: 25% limit for housing
                    const baseRate = calculateYearlyAverage(tufeRates, '2022');
                    if (propertyType === 'konut') {
                        maxLegalRate = Math.min(baseRate, 25);
                        rateType = '%25 Sınırı';
                    } else {
                        maxLegalRate = baseRate;
                        rateType = 'TÜFE 12A ort.';
                    }
                } else if (year === 2023) {
                    // 2023: Full year 25% limit for housing
                    const baseRate = calculateYearlyAverage(tufeRates, '2022');
                    if (propertyType === 'konut') {
                        maxLegalRate = Math.min(baseRate, 25);
                        rateType = '%25 Sınırı';
                    } else {
                        maxLegalRate = baseRate;
                        rateType = 'TÜFE 12A ort.';
                    }
                } else if (year === 2024) {
                    // 2024: 25% limit until July 1, then back to TÜFE
                    const baseRate = legalRatesByYear[year] || 0;
                    const checkDate = new Date(contractDate);
                    checkDate.setFullYear(year);
                    const limitEndDate = new Date('2024-07-01');
                    
                    if (propertyType === 'konut' && checkDate < limitEndDate) {
                        maxLegalRate = Math.min(baseRate, 25);
                        rateType = '%25 Sınırı';
                    } else {
                        maxLegalRate = baseRate;
                        rateType = 'TÜFE 12A ort.';
                    }
                } else if (year >= 2025) {
                    // 2025+: Back to TÜFE for all
                    maxLegalRate = legalRatesByYear[year] || calculateYearlyAverage(tufeRates, (year-1).toString());
                    rateType = 'TÜFE 12A ort.';
                }
                
                if (maxLegalRate === 0) {
                    maxLegalRate = 25;
                    rateType = 'Varsayılan';
                }
                
                const expectedRent = Math.round(baseRent * (1 + contractRate / 100) * 100) / 100;
                const monthlyDiff = Math.max(0, expectedRent - paidAmount);
                const yearlyDiff = monthlyDiff * 12; // Her zaman 12 ay

                totalMissing += yearlyDiff;
                totalExpected += expectedRent * 12;
                totalPaid += paidAmount * 12;

                calculationData.push({
                    year,
                    contractRate,
                    selectedRateType, // Seçilen oran türü (dropdown'dan)
                    maxLegalRate, // O yılki en fazla olabilecek oran
                    rateType, // Maks yasal oran türü (TÜFE/ÜFE/%25 Sınırı)
                    expectedRent,
                    paidAmount,
                    monthlyDiff,
                    yearlyDiff
                });

                baseRent = expectedRent; // Bir sonraki yıl için baz
            }

            displayResults(totalMissing, totalExpected, totalPaid);
        }

        function displayResults(totalMissing, totalExpected, totalPaid) {
            document.getElementById('totalMissing').textContent = formatMoney(totalMissing);
            document.getElementById('totalExpected').textContent = formatMoney(totalExpected);
            document.getElementById('totalPaid').textContent = formatMoney(totalPaid);
            document.getElementById('footerTotal').textContent = formatMoney(totalMissing);

            const tbody = document.getElementById('resultsBody');
            tbody.innerHTML = '';

            calculationData.forEach(data => {
                const row = tbody.insertRow();
                const diffClass = data.yearlyDiff > 0 ? 'positive' : 'negative';
                
                row.innerHTML = `
                    <td><strong>${data.year}</strong></td>
                    <td>%${data.contractRate.toFixed(2)} <br><small style="color: #6b7280; font-size: 0.75em;">(${data.selectedRateType})</small></td>
                    <td style="color: #6b7280; font-size: 0.9em;">%${data.maxLegalRate.toFixed(2)} <span style="font-size: 0.8em;">(${data.rateType})</span></td>
                    <td><strong>${formatMoney(data.expectedRent)}</strong></td>
                    <td>${formatMoney(data.paidAmount)}</td>
                    <td class="${diffClass}"><strong>${formatMoney(data.monthlyDiff)}</strong></td>
                    <td class="${diffClass}" style="font-size: 1.1em;"><strong>${formatMoney(data.yearlyDiff)}</strong></td>
                `;
            });

            document.getElementById('results').style.display = 'block';
            document.getElementById('results').scrollIntoView({ behavior: 'smooth' });
        }

        function formatMoney(amount) {
            return new Intl.NumberFormat('tr-TR', {
                style: 'currency',
                currency: 'TRY',
                minimumFractionDigits: 0,
                maximumFractionDigits: 0
            }).format(amount);
        }

        function exportResults() {
            generateExcel();
        }

        function generateCSV() {
            let csv = 'Yıl,Sözleşme Oranı,Seçilen Tür,Maks. Yasal,Oran Türü,Beklenen,Ödenen,Aylık Fark,Yıllık Fark\n';
            
            calculationData.forEach(data => {
                csv += `${data.year},${data.contractRate.toFixed(2)}%,${data.selectedRateType},${data.maxLegalRate.toFixed(2)}%,${data.rateType},${data.expectedRent.toFixed(2)},${data.paidAmount.toFixed(2)},${data.monthlyDiff.toFixed(2)},${data.yearlyDiff.toFixed(2)}\n`;
            });

            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'eksik-kira-hesaplama.csv';
            link.click();
        }

        function generateExcel() {
            if (!calculationData || calculationData.length === 0) {
                alert('Önce hesaplama yapınız!');
                return;
            }
            
            try {
                const totalMissing = calculationData.reduce((sum, data) => sum + data.yearlyDiff, 0);
                const totalExpected = calculationData.reduce((sum, data) => sum + (data.expectedRent * 12), 0);
                const totalPaid = calculationData.reduce((sum, data) => sum + (data.paidAmount * 12), 0);
                
                // Excel çalışma kitabı oluştur
                const wb = XLSX.utils.book_new();
            
            // Veri dizisini oluştur
            const wsData = [];
            
            // Başlık bilgileri
            wsData.push(['EKSİK KİRA HESAPLAMA RAPORU']);
            wsData.push(['Rapor Tarihi:', new Date().toLocaleDateString('tr-TR')]);
            wsData.push(['']); // Boş satır
            
            // Özet bilgileri
            wsData.push(['ÖZET BİLGİLER']);
            wsData.push(['Toplam Eksik Kira:', formatMoney(totalMissing)]);
            wsData.push(['Olması Gereken Toplam:', formatMoney(totalExpected)]);
            wsData.push(['Ödenen Toplam:', formatMoney(totalPaid)]);
            wsData.push(['']); // Boş satır
            
            // Tablo başlıkları
            wsData.push([
                'YIL',
                'SÖZLEŞMEDEKİ ORAN (%)',
                'ORAN TÜRÜ',
                'MAKS. YASAL ORAN (%)',
                'YASAL ORAN TÜRÜ',
                'BEKLENEN AYLIK KİRA (₺)',
                'ÖDENEN AYLIK KİRA (₺)',
                'AYLIK FARK (₺)',
                'YILLIK FARK (₺)'
            ]);
            
            // Veri satırları
            calculationData.forEach(data => {
                wsData.push([
                    data.year,
                    data.contractRate.toFixed(2),
                    data.selectedRateType,
                    data.maxLegalRate.toFixed(2),
                    data.rateType,
                    data.expectedRent.toFixed(0),
                    data.paidAmount.toFixed(0),
                    data.monthlyDiff.toFixed(0),
                    data.yearlyDiff.toFixed(0)
                ]);
            });
            
            // Toplam satırı
            wsData.push(['']); // Boş satır
            wsData.push([
                'TOPLAM',
                '', '', '', '',
                '',
                '',
                '',
                totalMissing.toFixed(0)
            ]);
            
            // Çalışma sayfası oluştur
            const ws = XLSX.utils.aoa_to_sheet(wsData);
            
            // Sütun genişliklerini ayarla (her şey net görünsün)
            ws['!cols'] = [
                { wch: 8 },  // YIL
                { wch: 18 }, // SÖZLEŞMEDEKİ ORAN
                { wch: 25 }, // ORAN TÜRÜ
                { wch: 18 }, // MAKS. YASAL ORAN
                { wch: 15 }, // YASAL ORAN TÜRÜ
                { wch: 20 }, // BEKLENEN KİRA
                { wch: 18 }, // ÖDENEN KİRA
                { wch: 15 }, // AYLIK FARK
                { wch: 15 }  // YILLIK FARK
            ];
            
            // Hücre stillerini ayarla
            const headerRow = 9; // Tablo başlık satırı
            const dataStartRow = 10; // Veri başlangıç satırı
            
            // Başlık satırı stil
            for (let col = 0; col < 9; col++) {
                const cellRef = XLSX.utils.encode_cell({ r: headerRow, c: col });
                if (!ws[cellRef]) ws[cellRef] = { t: 's', v: '' };
                ws[cellRef].s = {
                    font: { bold: true, color: { rgb: 'FFFFFF' } },
                    fill: { fgColor: { rgb: '4F46E5' } },
                    alignment: { horizontal: 'center', vertical: 'center' },
                    border: {
                        top: { style: 'thin', color: { rgb: '000000' } },
                        bottom: { style: 'thin', color: { rgb: '000000' } },
                        left: { style: 'thin', color: { rgb: '000000' } },
                        right: { style: 'thin', color: { rgb: '000000' } }
                    }
                };
            }
            
            // Veri satırları stil
            for (let row = dataStartRow; row < dataStartRow + calculationData.length; row++) {
                for (let col = 0; col < 9; col++) {
                    const cellRef = XLSX.utils.encode_cell({ r: row, c: col });
                    if (!ws[cellRef]) ws[cellRef] = { t: 's', v: '' };
                    
                    ws[cellRef].s = {
                        font: { size: 11 },
                        alignment: { horizontal: 'center', vertical: 'center' },
                        border: {
                            top: { style: 'thin', color: { rgb: 'CCCCCC' } },
                            bottom: { style: 'thin', color: { rgb: 'CCCCCC' } },
                            left: { style: 'thin', color: { rgb: 'CCCCCC' } },
                            right: { style: 'thin', color: { rgb: 'CCCCCC' } }
                        }
                    };
                    
                    // Zebra çizgiler
                    if ((row - dataStartRow) % 2 === 0) {
                        ws[cellRef].s.fill = { fgColor: { rgb: 'F9FAFB' } };
                    }
                    
                    // Fark sütunları için renklendirme
                    if (col === 7 || col === 8) { // Aylık fark ve yıllık fark
                        const value = parseFloat(wsData[row][col]);
                        if (value > 0) {
                            ws[cellRef].s.font = { color: { rgb: '059669' }, bold: true };
                        } else if (value < 0) {
                            ws[cellRef].s.font = { color: { rgb: 'DC2626' }, bold: true };
                        }
                    }
                }
            }
            
            // Toplam satırı stil
            const totalRow = dataStartRow + calculationData.length + 1;
            for (let col = 0; col < 9; col++) {
                const cellRef = XLSX.utils.encode_cell({ r: totalRow, c: col });
                if (!ws[cellRef]) ws[cellRef] = { t: 's', v: '' };
                ws[cellRef].s = {
                    font: { bold: true, color: { rgb: 'FFFFFF' }, size: 12 },
                    fill: { fgColor: { rgb: '4F46E5' } },
                    alignment: { horizontal: 'center', vertical: 'center' },
                    border: {
                        top: { style: 'thick', color: { rgb: '000000' } },
                        bottom: { style: 'thick', color: { rgb: '000000' } },
                        left: { style: 'thick', color: { rgb: '000000' } },
                        right: { style: 'thick', color: { rgb: '000000' } }
                    }
                };
            }
            
            // Başlık stili
            const titleCellRef = XLSX.utils.encode_cell({ r: 0, c: 0 });
            ws[titleCellRef].s = {
                font: { bold: true, size: 16, color: { rgb: '4F46E5' } },
                alignment: { horizontal: 'center' }
            };
            
            // Özet başlık stili
            const summaryTitleRef = XLSX.utils.encode_cell({ r: 3, c: 0 });
            ws[summaryTitleRef].s = {
                font: { bold: true, size: 12, color: { rgb: '059669' } },
                alignment: { horizontal: 'left' }
            };
            
                // Çalışma kitabına sayfa ekle
                XLSX.utils.book_append_sheet(wb, ws, 'Eksik Kira Raporu');
                
                // Excel dosyasını indir
                XLSX.writeFile(wb, 'eksik-kira-raporu.xlsx');
                
                // Memory cleanup
                wsData.length = 0;
                
            } catch (error) {
                console.error('Excel export hatası:', error);
                alert('Excel dosyası oluşturulurken bir hata oluştu. Lütfen tekrar deneyin.');
            }
        }
        
        function formatMoneySimple(amount) {
            return new Intl.NumberFormat('tr-TR', {
                style: 'currency',
                currency: 'TRY',
                minimumFractionDigits: 0,
                maximumFractionDigits: 0
            }).format(amount).replace('₺', '₺');
        }

        function resetCalculator() {
            location.reload();
        }

        // Mobile Menu JavaScript
        document.addEventListener('DOMContentLoaded', function() {
            const mobileMenuBtn = document.querySelector('.mobile-menu-btn');
            const mobileMenu = document.querySelector('.mobile-menu');
            
            if (mobileMenuBtn && mobileMenu) {
                mobileMenuBtn.addEventListener('click', function() {
                    mobileMenu.classList.toggle('active');
                    mobileMenuBtn.classList.toggle('active');
                    
                    // Prevent body scroll when menu is open
                    if (mobileMenu.classList.contains('active')) {
                        document.body.style.overflow = 'hidden';
                    } else {
                        document.body.style.overflow = '';
                    }
                });
                
                mobileMenu.addEventListener('click', function(e) {
                    if (e.target === mobileMenu) {
                        mobileMenu.classList.remove('active');
                        mobileMenuBtn.classList.remove('active');
                        document.body.style.overflow = '';
                    }
                });
                
                // Close menu on link click
                const menuLinks = mobileMenu.querySelectorAll('a');
                menuLinks.forEach(link => {
                    link.addEventListener('click', function() {
                        mobileMenu.classList.remove('active');
                        mobileMenuBtn.classList.remove('active');
                        document.body.style.overflow = '';
                    });
                });
                
                // Handle window resize
                window.addEventListener('resize', function() {
                    if (window.innerWidth > 768) {
                        mobileMenu.classList.remove('active');
                        mobileMenuBtn.classList.remove('active');
                        document.body.style.overflow = '';
                    }
                });
            }
            
            // Mobile form improvements
            const inputs = document.querySelectorAll('input, select');
            inputs.forEach(input => {
                input.addEventListener('focus', function() {
                    // Scroll input into view on mobile
                    if (window.innerWidth <= 768) {
                        setTimeout(() => {
                            this.scrollIntoView({ 
                                behavior: 'smooth', 
                                block: 'center' 
                            });
                        }, 300);
                    }
                });
            });
        });

        // Yearly average calculation function
        function calculateYearlyAverage(rates, year) {
            const yearData = rates[year];
            if (!yearData) return 0;
            
            const values = Object.values(yearData);
            return values.reduce((sum, val) => sum + val, 0) / values.length;
        }
    </script>
</body>
</html>